{"ast":null,"code":"/**\n * Copyright 2023 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { httpRequest } from '../httpUtil.js';\nimport { BrowserPlatform } from './types.js';\nfunction archive(platform) {\n  switch (platform) {\n    case BrowserPlatform.LINUX:\n      return 'chromedriver_linux64';\n    case BrowserPlatform.MAC_ARM:\n      return 'chromedriver_mac_arm64';\n    case BrowserPlatform.MAC:\n      return 'chromedriver_mac64';\n    case BrowserPlatform.WIN32:\n    case BrowserPlatform.WIN64:\n      return 'chromedriver_win32';\n  }\n}\nexport function resolveDownloadUrl(platform, buildId, baseUrl = 'https://chromedriver.storage.googleapis.com') {\n  return `${baseUrl}/${resolveDownloadPath(platform, buildId).join('/')}`;\n}\nexport function resolveDownloadPath(platform, buildId) {\n  return [buildId, `${archive(platform)}.zip`];\n}\nexport function relativeExecutablePath(platform, _buildId) {\n  switch (platform) {\n    case BrowserPlatform.MAC:\n    case BrowserPlatform.MAC_ARM:\n    case BrowserPlatform.LINUX:\n      return 'chromedriver';\n    case BrowserPlatform.WIN32:\n    case BrowserPlatform.WIN64:\n      return 'chromedriver.exe';\n  }\n}\nexport async function resolveBuildId(_channel = 'latest') {\n  return new Promise((resolve, reject) => {\n    const request = httpRequest(new URL(`https://chromedriver.storage.googleapis.com/LATEST_RELEASE`), 'GET', response => {\n      let data = '';\n      if (response.statusCode && response.statusCode >= 400) {\n        return reject(new Error(`Got status code ${response.statusCode}`));\n      }\n      response.on('data', chunk => {\n        data += chunk;\n      });\n      response.on('end', () => {\n        try {\n          return resolve(String(data));\n        } catch {\n          return reject(new Error('Chrome version not found'));\n        }\n      });\n    }, false);\n    request.on('error', err => {\n      reject(err);\n    });\n  });\n}","map":{"version":3,"names":["httpRequest","BrowserPlatform","archive","platform","LINUX","MAC_ARM","MAC","WIN32","WIN64","resolveDownloadUrl","buildId","baseUrl","resolveDownloadPath","join","relativeExecutablePath","_buildId","resolveBuildId","_channel","Promise","resolve","reject","request","URL","response","data","statusCode","Error","on","chunk","String","err"],"sources":["../../../src/browser-data/chromedriver.ts"],"sourcesContent":[null],"mappings":"AAAA;;;;;;;;;;;;;;;AAgBA,SAAQA,WAAW,QAAO,gBAAgB;AAE1C,SAAQC,eAAe,QAAO,YAAY;AAE1C,SAASC,OAAOA,CAACC,QAAyB;EACxC,QAAQA,QAAQ;IACd,KAAKF,eAAe,CAACG,KAAK;MACxB,OAAO,sBAAsB;IAC/B,KAAKH,eAAe,CAACI,OAAO;MAC1B,OAAO,wBAAwB;IACjC,KAAKJ,eAAe,CAACK,GAAG;MACtB,OAAO,oBAAoB;IAC7B,KAAKL,eAAe,CAACM,KAAK;IAC1B,KAAKN,eAAe,CAACO,KAAK;MACxB,OAAO,oBAAoB;;AAEjC;AAEA,OAAM,SAAUC,kBAAkBA,CAChCN,QAAyB,EACzBO,OAAe,EACfC,OAAO,GAAG,6CAA6C;EAEvD,OAAO,GAAGA,OAAO,IAAIC,mBAAmB,CAACT,QAAQ,EAAEO,OAAO,CAAC,CAACG,IAAI,CAAC,GAAG,CAAC,EAAE;AACzE;AAEA,OAAM,SAAUD,mBAAmBA,CACjCT,QAAyB,EACzBO,OAAe;EAEf,OAAO,CAACA,OAAO,EAAE,GAAGR,OAAO,CAACC,QAAQ,CAAC,MAAM,CAAC;AAC9C;AAEA,OAAM,SAAUW,sBAAsBA,CACpCX,QAAyB,EACzBY,QAAgB;EAEhB,QAAQZ,QAAQ;IACd,KAAKF,eAAe,CAACK,GAAG;IACxB,KAAKL,eAAe,CAACI,OAAO;IAC5B,KAAKJ,eAAe,CAACG,KAAK;MACxB,OAAO,cAAc;IACvB,KAAKH,eAAe,CAACM,KAAK;IAC1B,KAAKN,eAAe,CAACO,KAAK;MACxB,OAAO,kBAAkB;;AAE/B;AACA,OAAO,eAAeQ,cAAcA,CAClCC,QAAA,GAAqB,QAAQ;EAE7B,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAI;IACrC,MAAMC,OAAO,GAAGrB,WAAW,CACzB,IAAIsB,GAAG,CAAC,4DAA4D,CAAC,EACrE,KAAK,EACLC,QAAQ,IAAG;MACT,IAAIC,IAAI,GAAG,EAAE;MACb,IAAID,QAAQ,CAACE,UAAU,IAAIF,QAAQ,CAACE,UAAU,IAAI,GAAG,EAAE;QACrD,OAAOL,MAAM,CAAC,IAAIM,KAAK,CAAC,mBAAmBH,QAAQ,CAACE,UAAU,EAAE,CAAC,CAAC;;MAEpEF,QAAQ,CAACI,EAAE,CAAC,MAAM,EAAEC,KAAK,IAAG;QAC1BJ,IAAI,IAAII,KAAK;MACf,CAAC,CAAC;MACFL,QAAQ,CAACI,EAAE,CAAC,KAAK,EAAE,MAAK;QACtB,IAAI;UACF,OAAOR,OAAO,CAACU,MAAM,CAACL,IAAI,CAAC,CAAC;SAC7B,CAAC,MAAM;UACN,OAAOJ,MAAM,CAAC,IAAIM,KAAK,CAAC,0BAA0B,CAAC,CAAC;;MAExD,CAAC,CAAC;IACJ,CAAC,EACD,KAAK,CACN;IACDL,OAAO,CAACM,EAAE,CAAC,OAAO,EAAEG,GAAG,IAAG;MACxBV,MAAM,CAACU,GAAG,CAAC;IACb,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}