{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2023 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nvar _Cache_rootDir;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Cache = void 0;\nconst fs_1 = __importDefault(require(\"fs\"));\nconst path_1 = __importDefault(require(\"path\"));\nconst browser_data_js_1 = require(\"./browser-data/browser-data.js\");\n/**\n * The cache used by Puppeteer relies on the following structure:\n *\n * - rootDir\n *   -- <browser1> | browserRoot(browser1)\n *   ---- <platform>-<buildId> | installationDir()\n *   ------ the browser-platform-buildId\n *   ------ specific structure.\n *   -- <browser2> | browserRoot(browser2)\n *   ---- <platform>-<buildId> | installationDir()\n *   ------ the browser-platform-buildId\n *   ------ specific structure.\n *   @internal\n */\nclass Cache {\n  constructor(rootDir) {\n    _Cache_rootDir.set(this, void 0);\n    __classPrivateFieldSet(this, _Cache_rootDir, rootDir, \"f\");\n  }\n  browserRoot(browser) {\n    // Chromium is a special case for backward compatibility: we install it in\n    // the Chrome folder so that Puppeteer can find it.\n    return path_1.default.join(__classPrivateFieldGet(this, _Cache_rootDir, \"f\"), browser === browser_data_js_1.Browser.CHROMIUM ? browser_data_js_1.Browser.CHROME : browser);\n  }\n  installationDir(browser, platform, buildId) {\n    return path_1.default.join(this.browserRoot(browser), `${platform}-${buildId}`);\n  }\n  clear() {\n    fs_1.default.rmSync(__classPrivateFieldGet(this, _Cache_rootDir, \"f\"), {\n      force: true,\n      recursive: true,\n      maxRetries: 10,\n      retryDelay: 500\n    });\n  }\n  getInstalledBrowsers() {\n    if (!fs_1.default.existsSync(__classPrivateFieldGet(this, _Cache_rootDir, \"f\"))) {\n      return [];\n    }\n    const types = fs_1.default.readdirSync(__classPrivateFieldGet(this, _Cache_rootDir, \"f\"));\n    const browsers = types.filter(t => {\n      return Object.values(browser_data_js_1.Browser).includes(t);\n    });\n    return browsers.flatMap(browser => {\n      const files = fs_1.default.readdirSync(this.browserRoot(browser));\n      return files.map(file => {\n        const result = parseFolderPath(path_1.default.join(this.browserRoot(browser), file));\n        if (!result) {\n          return null;\n        }\n        return {\n          path: path_1.default.join(this.browserRoot(browser), file),\n          browser,\n          platform: result.platform,\n          buildId: result.buildId\n        };\n      }).filter(item => {\n        return item !== null;\n      });\n    });\n  }\n}\nexports.Cache = Cache;\n_Cache_rootDir = new WeakMap();\nfunction parseFolderPath(folderPath) {\n  const name = path_1.default.basename(folderPath);\n  const splits = name.split('-');\n  if (splits.length !== 2) {\n    return;\n  }\n  const [platform, buildId] = splits;\n  if (!buildId || !platform) {\n    return;\n  }\n  return {\n    platform,\n    buildId\n  };\n}","map":{"version":3,"names":["fs_1","__importDefault","require","path_1","browser_data_js_1","Cache","constructor","rootDir","_Cache_rootDir","set","__classPrivateFieldSet","browserRoot","browser","default","join","__classPrivateFieldGet","Browser","CHROMIUM","CHROME","installationDir","platform","buildId","clear","rmSync","force","recursive","maxRetries","retryDelay","getInstalledBrowsers","existsSync","types","readdirSync","browsers","filter","t","Object","values","includes","flatMap","files","map","file","result","parseFolderPath","path","item","exports","folderPath","name","basename","splits","split","length"],"sources":["../../src/Cache.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}