{"ast":null,"code":"\"use strict\";\n\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _HTTPResponse_instances, _HTTPResponse_client, _HTTPResponse_request, _HTTPResponse_contentPromise, _HTTPResponse_bodyLoadedPromise, _HTTPResponse_remoteAddress, _HTTPResponse_status, _HTTPResponse_statusText, _HTTPResponse_url, _HTTPResponse_fromDiskCache, _HTTPResponse_fromServiceWorker, _HTTPResponse_headers, _HTTPResponse_securityDetails, _HTTPResponse_timing, _HTTPResponse_parseStatusTextFromExtrInfo;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.HTTPResponse = void 0;\nconst HTTPResponse_js_1 = require(\"../api/HTTPResponse.js\");\nconst DeferredPromise_js_1 = require(\"../util/DeferredPromise.js\");\nconst Errors_js_1 = require(\"./Errors.js\");\nconst SecurityDetails_js_1 = require(\"./SecurityDetails.js\");\n/**\n * @internal\n */\nclass HTTPResponse extends HTTPResponse_js_1.HTTPResponse {\n  constructor(client, request, responsePayload, extraInfo) {\n    super();\n    _HTTPResponse_instances.add(this);\n    _HTTPResponse_client.set(this, void 0);\n    _HTTPResponse_request.set(this, void 0);\n    _HTTPResponse_contentPromise.set(this, null);\n    _HTTPResponse_bodyLoadedPromise.set(this, (0, DeferredPromise_js_1.createDeferredPromise)());\n    _HTTPResponse_remoteAddress.set(this, void 0);\n    _HTTPResponse_status.set(this, void 0);\n    _HTTPResponse_statusText.set(this, void 0);\n    _HTTPResponse_url.set(this, void 0);\n    _HTTPResponse_fromDiskCache.set(this, void 0);\n    _HTTPResponse_fromServiceWorker.set(this, void 0);\n    _HTTPResponse_headers.set(this, {});\n    _HTTPResponse_securityDetails.set(this, void 0);\n    _HTTPResponse_timing.set(this, void 0);\n    __classPrivateFieldSet(this, _HTTPResponse_client, client, \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_request, request, \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_remoteAddress, {\n      ip: responsePayload.remoteIPAddress,\n      port: responsePayload.remotePort\n    }, \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_statusText, __classPrivateFieldGet(this, _HTTPResponse_instances, \"m\", _HTTPResponse_parseStatusTextFromExtrInfo).call(this, extraInfo) || responsePayload.statusText, \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_url, request.url(), \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_fromDiskCache, !!responsePayload.fromDiskCache, \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_fromServiceWorker, !!responsePayload.fromServiceWorker, \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_status, extraInfo ? extraInfo.statusCode : responsePayload.status, \"f\");\n    const headers = extraInfo ? extraInfo.headers : responsePayload.headers;\n    for (const [key, value] of Object.entries(headers)) {\n      __classPrivateFieldGet(this, _HTTPResponse_headers, \"f\")[key.toLowerCase()] = value;\n    }\n    __classPrivateFieldSet(this, _HTTPResponse_securityDetails, responsePayload.securityDetails ? new SecurityDetails_js_1.SecurityDetails(responsePayload.securityDetails) : null, \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_timing, responsePayload.timing || null, \"f\");\n  }\n  _resolveBody(err) {\n    if (err) {\n      return __classPrivateFieldGet(this, _HTTPResponse_bodyLoadedPromise, \"f\").resolve(err);\n    }\n    return __classPrivateFieldGet(this, _HTTPResponse_bodyLoadedPromise, \"f\").resolve();\n  }\n  remoteAddress() {\n    return __classPrivateFieldGet(this, _HTTPResponse_remoteAddress, \"f\");\n  }\n  url() {\n    return __classPrivateFieldGet(this, _HTTPResponse_url, \"f\");\n  }\n  ok() {\n    // TODO: document === 0 case?\n    return __classPrivateFieldGet(this, _HTTPResponse_status, \"f\") === 0 || __classPrivateFieldGet(this, _HTTPResponse_status, \"f\") >= 200 && __classPrivateFieldGet(this, _HTTPResponse_status, \"f\") <= 299;\n  }\n  status() {\n    return __classPrivateFieldGet(this, _HTTPResponse_status, \"f\");\n  }\n  statusText() {\n    return __classPrivateFieldGet(this, _HTTPResponse_statusText, \"f\");\n  }\n  headers() {\n    return __classPrivateFieldGet(this, _HTTPResponse_headers, \"f\");\n  }\n  securityDetails() {\n    return __classPrivateFieldGet(this, _HTTPResponse_securityDetails, \"f\");\n  }\n  timing() {\n    return __classPrivateFieldGet(this, _HTTPResponse_timing, \"f\");\n  }\n  buffer() {\n    if (!__classPrivateFieldGet(this, _HTTPResponse_contentPromise, \"f\")) {\n      __classPrivateFieldSet(this, _HTTPResponse_contentPromise, __classPrivateFieldGet(this, _HTTPResponse_bodyLoadedPromise, \"f\").then(async error => {\n        if (error) {\n          throw error;\n        }\n        try {\n          const response = await __classPrivateFieldGet(this, _HTTPResponse_client, \"f\").send('Network.getResponseBody', {\n            requestId: __classPrivateFieldGet(this, _HTTPResponse_request, \"f\")._requestId\n          });\n          return Buffer.from(response.body, response.base64Encoded ? 'base64' : 'utf8');\n        } catch (error) {\n          if (error instanceof Errors_js_1.ProtocolError && error.originalMessage === 'No resource with given identifier found') {\n            throw new Errors_js_1.ProtocolError('Could not load body for this request. This might happen if the request is a preflight request.');\n          }\n          throw error;\n        }\n      }), \"f\");\n    }\n    return __classPrivateFieldGet(this, _HTTPResponse_contentPromise, \"f\");\n  }\n  request() {\n    return __classPrivateFieldGet(this, _HTTPResponse_request, \"f\");\n  }\n  fromCache() {\n    return __classPrivateFieldGet(this, _HTTPResponse_fromDiskCache, \"f\") || __classPrivateFieldGet(this, _HTTPResponse_request, \"f\")._fromMemoryCache;\n  }\n  fromServiceWorker() {\n    return __classPrivateFieldGet(this, _HTTPResponse_fromServiceWorker, \"f\");\n  }\n  frame() {\n    return __classPrivateFieldGet(this, _HTTPResponse_request, \"f\").frame();\n  }\n}\nexports.HTTPResponse = HTTPResponse;\n_HTTPResponse_client = new WeakMap(), _HTTPResponse_request = new WeakMap(), _HTTPResponse_contentPromise = new WeakMap(), _HTTPResponse_bodyLoadedPromise = new WeakMap(), _HTTPResponse_remoteAddress = new WeakMap(), _HTTPResponse_status = new WeakMap(), _HTTPResponse_statusText = new WeakMap(), _HTTPResponse_url = new WeakMap(), _HTTPResponse_fromDiskCache = new WeakMap(), _HTTPResponse_fromServiceWorker = new WeakMap(), _HTTPResponse_headers = new WeakMap(), _HTTPResponse_securityDetails = new WeakMap(), _HTTPResponse_timing = new WeakMap(), _HTTPResponse_instances = new WeakSet(), _HTTPResponse_parseStatusTextFromExtrInfo = function _HTTPResponse_parseStatusTextFromExtrInfo(extraInfo) {\n  if (!extraInfo || !extraInfo.headersText) {\n    return;\n  }\n  const firstLine = extraInfo.headersText.split('\\r', 1)[0];\n  if (!firstLine) {\n    return;\n  }\n  const match = firstLine.match(/[^ ]* [^ ]* (.*)/);\n  if (!match) {\n    return;\n  }\n  const statusText = match[1];\n  if (!statusText) {\n    return;\n  }\n  return statusText;\n};","map":{"version":3,"names":["HTTPResponse_js_1","require","DeferredPromise_js_1","Errors_js_1","SecurityDetails_js_1","HTTPResponse","constructor","client","request","responsePayload","extraInfo","_HTTPResponse_client","set","_HTTPResponse_request","_HTTPResponse_contentPromise","_HTTPResponse_bodyLoadedPromise","createDeferredPromise","_HTTPResponse_remoteAddress","_HTTPResponse_status","_HTTPResponse_statusText","_HTTPResponse_url","_HTTPResponse_fromDiskCache","_HTTPResponse_fromServiceWorker","_HTTPResponse_headers","_HTTPResponse_securityDetails","_HTTPResponse_timing","__classPrivateFieldSet","ip","remoteIPAddress","port","remotePort","__classPrivateFieldGet","_HTTPResponse_instances","_HTTPResponse_parseStatusTextFromExtrInfo","call","statusText","url","fromDiskCache","fromServiceWorker","statusCode","status","headers","key","value","Object","entries","toLowerCase","securityDetails","SecurityDetails","timing","_resolveBody","err","resolve","remoteAddress","ok","buffer","then","error","response","send","requestId","_requestId","Buffer","from","body","base64Encoded","ProtocolError","originalMessage","fromCache","_fromMemoryCache","frame","exports","headersText","firstLine","split","match"],"sources":["../../../../src/common/HTTPResponse.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}