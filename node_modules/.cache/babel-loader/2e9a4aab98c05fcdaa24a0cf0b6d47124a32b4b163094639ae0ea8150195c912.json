{"ast":null,"code":"\"use strict\";\n\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _WebWorker_executionContext, _WebWorker_client, _WebWorker_url;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WebWorker = void 0;\nconst DeferredPromise_js_1 = require(\"../util/DeferredPromise.js\");\nconst EventEmitter_js_1 = require(\"./EventEmitter.js\");\nconst ExecutionContext_js_1 = require(\"./ExecutionContext.js\");\nconst JSHandle_js_1 = require(\"./JSHandle.js\");\nconst util_js_1 = require(\"./util.js\");\n/**\n * This class represents a\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API | WebWorker}.\n *\n * @remarks\n * The events `workercreated` and `workerdestroyed` are emitted on the page\n * object to signal the worker lifecycle.\n *\n * @example\n *\n * ```ts\n * page.on('workercreated', worker =>\n *   console.log('Worker created: ' + worker.url())\n * );\n * page.on('workerdestroyed', worker =>\n *   console.log('Worker destroyed: ' + worker.url())\n * );\n *\n * console.log('Current workers:');\n * for (const worker of page.workers()) {\n *   console.log('  ' + worker.url());\n * }\n * ```\n *\n * @public\n */\nclass WebWorker extends EventEmitter_js_1.EventEmitter {\n  /**\n   * @internal\n   */\n  constructor(client, url, consoleAPICalled, exceptionThrown) {\n    super();\n    _WebWorker_executionContext.set(this, (0, DeferredPromise_js_1.createDeferredPromise)());\n    _WebWorker_client.set(this, void 0);\n    _WebWorker_url.set(this, void 0);\n    __classPrivateFieldSet(this, _WebWorker_client, client, \"f\");\n    __classPrivateFieldSet(this, _WebWorker_url, url, \"f\");\n    __classPrivateFieldGet(this, _WebWorker_client, \"f\").once('Runtime.executionContextCreated', async event => {\n      const context = new ExecutionContext_js_1.ExecutionContext(client, event.context);\n      __classPrivateFieldGet(this, _WebWorker_executionContext, \"f\").resolve(context);\n    });\n    __classPrivateFieldGet(this, _WebWorker_client, \"f\").on('Runtime.consoleAPICalled', async event => {\n      const context = await __classPrivateFieldGet(this, _WebWorker_executionContext, \"f\");\n      return consoleAPICalled(event.type, event.args.map(object => {\n        return new JSHandle_js_1.CDPJSHandle(context, object);\n      }), event.stackTrace);\n    });\n    __classPrivateFieldGet(this, _WebWorker_client, \"f\").on('Runtime.exceptionThrown', exception => {\n      return exceptionThrown(exception.exceptionDetails);\n    });\n    // This might fail if the target is closed before we receive all execution contexts.\n    __classPrivateFieldGet(this, _WebWorker_client, \"f\").send('Runtime.enable').catch(util_js_1.debugError);\n  }\n  /**\n   * @internal\n   */\n  async executionContext() {\n    return __classPrivateFieldGet(this, _WebWorker_executionContext, \"f\");\n  }\n  /**\n   * The URL of this web worker.\n   */\n  url() {\n    return __classPrivateFieldGet(this, _WebWorker_url, \"f\");\n  }\n  /**\n   * The CDP session client the WebWorker belongs to.\n   */\n  get client() {\n    return __classPrivateFieldGet(this, _WebWorker_client, \"f\");\n  }\n  /**\n   * If the function passed to the `worker.evaluate` returns a Promise, then\n   * `worker.evaluate` would wait for the promise to resolve and return its\n   * value. If the function passed to the `worker.evaluate` returns a\n   * non-serializable value, then `worker.evaluate` resolves to `undefined`.\n   * DevTools Protocol also supports transferring some additional values that\n   * are not serializable by `JSON`: `-0`, `NaN`, `Infinity`, `-Infinity`, and\n   * bigint literals.\n   * Shortcut for `await worker.executionContext()).evaluate(pageFunction, ...args)`.\n   *\n   * @param pageFunction - Function to be evaluated in the worker context.\n   * @param args - Arguments to pass to `pageFunction`.\n   * @returns Promise which resolves to the return value of `pageFunction`.\n   */\n  async evaluate(pageFunction, ...args) {\n    const context = await __classPrivateFieldGet(this, _WebWorker_executionContext, \"f\");\n    return context.evaluate(pageFunction, ...args);\n  }\n  /**\n   * The only difference between `worker.evaluate` and `worker.evaluateHandle`\n   * is that `worker.evaluateHandle` returns in-page object (JSHandle). If the\n   * function passed to the `worker.evaluateHandle` returns a `Promise`, then\n   * `worker.evaluateHandle` would wait for the promise to resolve and return\n   * its value. Shortcut for\n   * `await worker.executionContext()).evaluateHandle(pageFunction, ...args)`\n   *\n   * @param pageFunction - Function to be evaluated in the page context.\n   * @param args - Arguments to pass to `pageFunction`.\n   * @returns Promise which resolves to the return value of `pageFunction`.\n   */\n  async evaluateHandle(pageFunction, ...args) {\n    const context = await __classPrivateFieldGet(this, _WebWorker_executionContext, \"f\");\n    return context.evaluateHandle(pageFunction, ...args);\n  }\n}\nexports.WebWorker = WebWorker;\n_WebWorker_executionContext = new WeakMap(), _WebWorker_client = new WeakMap(), _WebWorker_url = new WeakMap();","map":{"version":3,"names":["DeferredPromise_js_1","require","EventEmitter_js_1","ExecutionContext_js_1","JSHandle_js_1","util_js_1","WebWorker","EventEmitter","constructor","client","url","consoleAPICalled","exceptionThrown","_WebWorker_executionContext","set","createDeferredPromise","_WebWorker_client","_WebWorker_url","__classPrivateFieldSet","__classPrivateFieldGet","once","event","context","ExecutionContext","resolve","on","type","args","map","object","CDPJSHandle","stackTrace","exception","exceptionDetails","send","catch","debugError","executionContext","evaluate","pageFunction","evaluateHandle","exports"],"sources":["../../../../src/common/WebWorker.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;;;;;;;AAiBA,MAAAA,oBAAA,GAAAC,OAAA;AAIA,MAAAC,iBAAA,GAAAD,OAAA;AACA,MAAAE,qBAAA,GAAAF,OAAA;AACA,MAAAG,aAAA,GAAAH,OAAA;AAEA,MAAAI,SAAA,GAAAJ,OAAA;AAkBA;;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA,MAAaK,SAAU,SAAQJ,iBAAA,CAAAK,YAAY;EAMzC;;;EAGAC,YACEC,MAAkB,EAClBC,GAAW,EACXC,gBAA0C,EAC1CC,eAAwC;IAExC,KAAK,EAAE;IAdTC,2BAAA,CAAAC,GAAA,OAAoB,IAAAd,oBAAA,CAAAe,qBAAqB,GAAoB;IAE7DC,iBAAA,CAAAF,GAAA;IACAG,cAAA,CAAAH,GAAA;IAYEI,sBAAA,KAAI,EAAAF,iBAAA,EAAWP,MAAM;IACrBS,sBAAA,KAAI,EAAAD,cAAA,EAAQP,GAAG;IAEfS,sBAAA,KAAI,EAAAH,iBAAA,MAAQ,CAACI,IAAI,CAAC,iCAAiC,EAAE,MAAMC,KAAK,IAAG;MACjE,MAAMC,OAAO,GAAG,IAAInB,qBAAA,CAAAoB,gBAAgB,CAACd,MAAM,EAAEY,KAAK,CAACC,OAAO,CAAC;MAC3DH,sBAAA,KAAI,EAAAN,2BAAA,MAAkB,CAACW,OAAO,CAACF,OAAO,CAAC;IACzC,CAAC,CAAC;IACFH,sBAAA,KAAI,EAAAH,iBAAA,MAAQ,CAACS,EAAE,CAAC,0BAA0B,EAAE,MAAMJ,KAAK,IAAG;MACxD,MAAMC,OAAO,GAAG,MAAMH,sBAAA,KAAI,EAAAN,2BAAA,MAAkB;MAC5C,OAAOF,gBAAgB,CACrBU,KAAK,CAACK,IAAI,EACVL,KAAK,CAACM,IAAI,CAACC,GAAG,CAAEC,MAAqC,IAAI;QACvD,OAAO,IAAIzB,aAAA,CAAA0B,WAAW,CAACR,OAAO,EAAEO,MAAM,CAAC;MACzC,CAAC,CAAC,EACFR,KAAK,CAACU,UAAU,CACjB;IACH,CAAC,CAAC;IACFZ,sBAAA,KAAI,EAAAH,iBAAA,MAAQ,CAACS,EAAE,CAAC,yBAAyB,EAAEO,SAAS,IAAG;MACrD,OAAOpB,eAAe,CAACoB,SAAS,CAACC,gBAAgB,CAAC;IACpD,CAAC,CAAC;IAEF;IACAd,sBAAA,KAAI,EAAAH,iBAAA,MAAQ,CAACkB,IAAI,CAAC,gBAAgB,CAAC,CAACC,KAAK,CAAC9B,SAAA,CAAA+B,UAAU,CAAC;EACvD;EAEA;;;EAGA,MAAMC,gBAAgBA,CAAA;IACpB,OAAOlB,sBAAA,KAAI,EAAAN,2BAAA,MAAkB;EAC/B;EAEA;;;EAGAH,GAAGA,CAAA;IACD,OAAOS,sBAAA,KAAI,EAAAF,cAAA,MAAK;EAClB;EAEA;;;EAGA,IAAIR,MAAMA,CAAA;IACR,OAAOU,sBAAA,KAAI,EAAAH,iBAAA,MAAQ;EACrB;EAEA;;;;;;;;;;;;;;EAcA,MAAMsB,QAAQA,CAIZC,YAA2B,EAC3B,GAAGZ,IAAY;IAEf,MAAML,OAAO,GAAG,MAAMH,sBAAA,KAAI,EAAAN,2BAAA,MAAkB;IAC5C,OAAOS,OAAO,CAACgB,QAAQ,CAACC,YAAY,EAAE,GAAGZ,IAAI,CAAC;EAChD;EAEA;;;;;;;;;;;;EAYA,MAAMa,cAAcA,CAIlBD,YAA2B,EAC3B,GAAGZ,IAAY;IAEf,MAAML,OAAO,GAAG,MAAMH,sBAAA,KAAI,EAAAN,2BAAA,MAAkB;IAC5C,OAAOS,OAAO,CAACkB,cAAc,CAACD,YAAY,EAAE,GAAGZ,IAAI,CAAC;EACtD;;AA5GFc,OAAA,CAAAnC,SAAA,GAAAA,SAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}