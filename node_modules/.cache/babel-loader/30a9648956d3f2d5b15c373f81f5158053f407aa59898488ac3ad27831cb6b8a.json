{"ast":null,"code":"/**\n * Copyright 2023 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport path from 'path';\nimport { httpRequest } from '../httpUtil.js';\nimport { BrowserPlatform, ChromeReleaseChannel } from './types.js';\nfunction folder(platform) {\n  switch (platform) {\n    case BrowserPlatform.LINUX:\n      return 'linux64';\n    case BrowserPlatform.MAC_ARM:\n      return 'mac-arm64';\n    case BrowserPlatform.MAC:\n      return 'mac-x64';\n    case BrowserPlatform.WIN32:\n      return 'win32';\n    case BrowserPlatform.WIN64:\n      return 'win64';\n  }\n}\nfunction chromiumDashPlatform(platform) {\n  switch (platform) {\n    case BrowserPlatform.LINUX:\n      return 'linux';\n    case BrowserPlatform.MAC_ARM:\n      return 'mac';\n    case BrowserPlatform.MAC:\n      return 'mac';\n    case BrowserPlatform.WIN32:\n      return 'win';\n    case BrowserPlatform.WIN64:\n      return 'win64';\n  }\n}\nexport function resolveDownloadUrl(platform, buildId, baseUrl = 'https://edgedl.me.gvt1.com/edgedl/chrome/chrome-for-testing') {\n  return `${baseUrl}/${resolveDownloadPath(platform, buildId).join('/')}`;\n}\nexport function resolveDownloadPath(platform, buildId) {\n  return [buildId, folder(platform), `chrome-${folder(platform)}.zip`];\n}\nexport function relativeExecutablePath(platform, _buildId) {\n  switch (platform) {\n    case BrowserPlatform.MAC:\n    case BrowserPlatform.MAC_ARM:\n      return path.join('chrome-' + folder(platform), 'Google Chrome for Testing.app', 'Contents', 'MacOS', 'Google Chrome for Testing');\n    case BrowserPlatform.LINUX:\n      return path.join('chrome-linux64', 'chrome');\n    case BrowserPlatform.WIN32:\n    case BrowserPlatform.WIN64:\n      return path.join('chrome-' + folder(platform), 'chrome.exe');\n  }\n}\nexport async function resolveBuildId(platform, channel = 'beta') {\n  return new Promise((resolve, reject) => {\n    const request = httpRequest(new URL(`https://chromiumdash.appspot.com/fetch_releases?platform=${chromiumDashPlatform(platform)}&channel=${channel}`), 'GET', response => {\n      let data = '';\n      if (response.statusCode && response.statusCode >= 400) {\n        return reject(new Error(`Got status code ${response.statusCode}`));\n      }\n      response.on('data', chunk => {\n        data += chunk;\n      });\n      response.on('end', () => {\n        try {\n          const response = JSON.parse(String(data));\n          return resolve(response[0].version);\n        } catch {\n          return reject(new Error('Chrome version not found'));\n        }\n      });\n    }, false);\n    request.on('error', err => {\n      reject(err);\n    });\n  });\n}\nexport function resolveSystemExecutablePath(platform, channel) {\n  switch (platform) {\n    case BrowserPlatform.WIN64:\n    case BrowserPlatform.WIN32:\n      switch (channel) {\n        case ChromeReleaseChannel.STABLE:\n          return `${process.env['PROGRAMFILES']}\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe`;\n        case ChromeReleaseChannel.BETA:\n          return `${process.env['PROGRAMFILES']}\\\\Google\\\\Chrome Beta\\\\Application\\\\chrome.exe`;\n        case ChromeReleaseChannel.CANARY:\n          return `${process.env['PROGRAMFILES']}\\\\Google\\\\Chrome SxS\\\\Application\\\\chrome.exe`;\n        case ChromeReleaseChannel.DEV:\n          return `${process.env['PROGRAMFILES']}\\\\Google\\\\Chrome Dev\\\\Application\\\\chrome.exe`;\n      }\n    case BrowserPlatform.MAC_ARM:\n    case BrowserPlatform.MAC:\n      switch (channel) {\n        case ChromeReleaseChannel.STABLE:\n          return '/Applications/Google Chrome.app/Contents/MacOS/Google Chrome';\n        case ChromeReleaseChannel.BETA:\n          return '/Applications/Google Chrome Beta.app/Contents/MacOS/Google Chrome Beta';\n        case ChromeReleaseChannel.CANARY:\n          return '/Applications/Google Chrome Canary.app/Contents/MacOS/Google Chrome Canary';\n        case ChromeReleaseChannel.DEV:\n          return '/Applications/Google Chrome Dev.app/Contents/MacOS/Google Chrome Dev';\n      }\n    case BrowserPlatform.LINUX:\n      switch (channel) {\n        case ChromeReleaseChannel.STABLE:\n          return '/opt/google/chrome/chrome';\n        case ChromeReleaseChannel.BETA:\n          return '/opt/google/chrome-beta/chrome';\n        case ChromeReleaseChannel.DEV:\n          return '/opt/google/chrome-unstable/chrome';\n      }\n  }\n  throw new Error(`Unable to detect browser executable path for '${channel}' on ${platform}.`);\n}","map":{"version":3,"names":["path","httpRequest","BrowserPlatform","ChromeReleaseChannel","folder","platform","LINUX","MAC_ARM","MAC","WIN32","WIN64","chromiumDashPlatform","resolveDownloadUrl","buildId","baseUrl","resolveDownloadPath","join","relativeExecutablePath","_buildId","resolveBuildId","channel","Promise","resolve","reject","request","URL","response","data","statusCode","Error","on","chunk","JSON","parse","String","version","err","resolveSystemExecutablePath","STABLE","process","env","BETA","CANARY","DEV"],"sources":["../../../src/browser-data/chrome.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}