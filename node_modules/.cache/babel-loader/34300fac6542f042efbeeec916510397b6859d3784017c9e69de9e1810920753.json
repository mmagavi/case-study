{"ast":null,"code":"/**\n * Copyright 2017 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { isNode } from '../environment.js';\nimport { assert } from '../util/assert.js';\nimport { isErrorLike } from '../util/ErrorLike.js';\nimport { debug } from './Debug.js';\nimport { CDPElementHandle } from './ElementHandle.js';\nimport { TimeoutError } from './Errors.js';\nimport { CDPJSHandle } from './JSHandle.js';\n/**\n * @internal\n */\nexport const debugError = debug('puppeteer:error');\n/**\n * @internal\n */\nexport function getExceptionMessage(exceptionDetails) {\n  if (exceptionDetails.exception) {\n    return exceptionDetails.exception.description || exceptionDetails.exception.value;\n  }\n  let message = exceptionDetails.text;\n  if (exceptionDetails.stackTrace) {\n    for (const callframe of exceptionDetails.stackTrace.callFrames) {\n      const location = callframe.url + ':' + callframe.lineNumber + ':' + callframe.columnNumber;\n      const functionName = callframe.functionName || '<anonymous>';\n      message += `\\n    at ${functionName} (${location})`;\n    }\n  }\n  return message;\n}\n/**\n * @internal\n */\nexport function valueFromRemoteObject(remoteObject) {\n  assert(!remoteObject.objectId, 'Cannot extract value when objectId is given');\n  if (remoteObject.unserializableValue) {\n    if (remoteObject.type === 'bigint') {\n      return BigInt(remoteObject.unserializableValue.replace('n', ''));\n    }\n    switch (remoteObject.unserializableValue) {\n      case '-0':\n        return -0;\n      case 'NaN':\n        return NaN;\n      case 'Infinity':\n        return Infinity;\n      case '-Infinity':\n        return -Infinity;\n      default:\n        throw new Error('Unsupported unserializable value: ' + remoteObject.unserializableValue);\n    }\n  }\n  return remoteObject.value;\n}\n/**\n * @internal\n */\nexport async function releaseObject(client, remoteObject) {\n  if (!remoteObject.objectId) {\n    return;\n  }\n  await client.send('Runtime.releaseObject', {\n    objectId: remoteObject.objectId\n  }).catch(error => {\n    // Exceptions might happen in case of a page been navigated or closed.\n    // Swallow these since they are harmless and we don't leak anything in this case.\n    debugError(error);\n  });\n}\n/**\n * @internal\n */\nexport function addEventListener(emitter, eventName, handler) {\n  emitter.on(eventName, handler);\n  return {\n    emitter,\n    eventName,\n    handler\n  };\n}\n/**\n * @internal\n */\nexport function removeEventListeners(listeners) {\n  for (const listener of listeners) {\n    listener.emitter.removeListener(listener.eventName, listener.handler);\n  }\n  listeners.length = 0;\n}\n/**\n * @internal\n */\nexport const isString = obj => {\n  return typeof obj === 'string' || obj instanceof String;\n};\n/**\n * @internal\n */\nexport const isNumber = obj => {\n  return typeof obj === 'number' || obj instanceof Number;\n};\n/**\n * @internal\n */\nexport const isPlainObject = obj => {\n  return typeof obj === 'object' && (obj === null || obj === void 0 ? void 0 : obj.constructor) === Object;\n};\n/**\n * @internal\n */\nexport const isRegExp = obj => {\n  return typeof obj === 'object' && (obj === null || obj === void 0 ? void 0 : obj.constructor) === RegExp;\n};\n/**\n * @internal\n */\nexport const isDate = obj => {\n  return typeof obj === 'object' && (obj === null || obj === void 0 ? void 0 : obj.constructor) === Date;\n};\n/**\n * @internal\n */\nexport async function waitForEvent(emitter, eventName, predicate, timeout, abortPromise) {\n  let eventTimeout;\n  let resolveCallback;\n  let rejectCallback;\n  const promise = new Promise((resolve, reject) => {\n    resolveCallback = resolve;\n    rejectCallback = reject;\n  });\n  const listener = addEventListener(emitter, eventName, async event => {\n    if (!(await predicate(event))) {\n      return;\n    }\n    resolveCallback(event);\n  });\n  if (timeout) {\n    eventTimeout = setTimeout(() => {\n      rejectCallback(new TimeoutError('Timeout exceeded while waiting for event'));\n    }, timeout);\n  }\n  function cleanup() {\n    removeEventListeners([listener]);\n    clearTimeout(eventTimeout);\n  }\n  const result = await Promise.race([promise, abortPromise]).then(r => {\n    cleanup();\n    return r;\n  }, error => {\n    cleanup();\n    throw error;\n  });\n  if (isErrorLike(result)) {\n    throw result;\n  }\n  return result;\n}\n/**\n * @internal\n */\nexport function createJSHandle(context, remoteObject) {\n  if (remoteObject.subtype === 'node' && context._world) {\n    return new CDPElementHandle(context, remoteObject, context._world.frame());\n  }\n  return new CDPJSHandle(context, remoteObject);\n}\n/**\n * @internal\n */\nexport function evaluationString(fun, ...args) {\n  if (isString(fun)) {\n    assert(args.length === 0, 'Cannot evaluate a string with arguments');\n    return fun;\n  }\n  function serializeArgument(arg) {\n    if (Object.is(arg, undefined)) {\n      return 'undefined';\n    }\n    return JSON.stringify(arg);\n  }\n  return `(${fun})(${args.map(serializeArgument).join(',')})`;\n}\n/**\n * @internal\n */\nexport function addPageBinding(type, name) {\n  // This is the CDP binding.\n  // @ts-expect-error: In a different context.\n  const callCDP = globalThis[name];\n  // We replace the CDP binding with a Puppeteer binding.\n  Object.assign(globalThis, {\n    [name](...args) {\n      var _a, _b, _c;\n      // This is the Puppeteer binding.\n      // @ts-expect-error: In a different context.\n      const callPuppeteer = globalThis[name];\n      (_a = callPuppeteer.args) !== null && _a !== void 0 ? _a : callPuppeteer.args = new Map();\n      (_b = callPuppeteer.callbacks) !== null && _b !== void 0 ? _b : callPuppeteer.callbacks = new Map();\n      const seq = ((_c = callPuppeteer.lastSeq) !== null && _c !== void 0 ? _c : 0) + 1;\n      callPuppeteer.lastSeq = seq;\n      callPuppeteer.args.set(seq, args);\n      callCDP(JSON.stringify({\n        type,\n        name,\n        seq,\n        args,\n        isTrivial: !args.some(value => {\n          return value instanceof Node;\n        })\n      }));\n      return new Promise((resolve, reject) => {\n        callPuppeteer.callbacks.set(seq, {\n          resolve(value) {\n            callPuppeteer.args.delete(seq);\n            resolve(value);\n          },\n          reject(value) {\n            callPuppeteer.args.delete(seq);\n            reject(value);\n          }\n        });\n      });\n    }\n  });\n}\n/**\n * @internal\n */\nexport function pageBindingInitString(type, name) {\n  return evaluationString(addPageBinding, type, name);\n}\n/**\n * @internal\n */\nexport async function waitWithTimeout(promise, taskName, timeout) {\n  let reject;\n  const timeoutError = new TimeoutError(`waiting for ${taskName} failed: timeout ${timeout}ms exceeded`);\n  const timeoutPromise = new Promise((_, rej) => {\n    return reject = rej;\n  });\n  let timeoutTimer = null;\n  if (timeout) {\n    timeoutTimer = setTimeout(() => {\n      return reject(timeoutError);\n    }, timeout);\n  }\n  try {\n    return await Promise.race([promise, timeoutPromise]);\n  } finally {\n    if (timeoutTimer) {\n      clearTimeout(timeoutTimer);\n    }\n  }\n}\n/**\n * @internal\n */\nlet fs = null;\n/**\n * @internal\n */\nexport async function importFSPromises() {\n  if (!fs) {\n    try {\n      fs = await import('fs/promises');\n    } catch (error) {\n      if (error instanceof TypeError) {\n        throw new Error('Cannot write to a path outside of a Node-like environment.');\n      }\n      throw error;\n    }\n  }\n  return fs;\n}\n/**\n * @internal\n */\nexport async function getReadableAsBuffer(readable, path) {\n  const buffers = [];\n  if (path) {\n    const fs = await importFSPromises();\n    const fileHandle = await fs.open(path, 'w+');\n    for await (const chunk of readable) {\n      buffers.push(chunk);\n      await fileHandle.writeFile(chunk);\n    }\n    await fileHandle.close();\n  } else {\n    for await (const chunk of readable) {\n      buffers.push(chunk);\n    }\n  }\n  try {\n    return Buffer.concat(buffers);\n  } catch (error) {\n    return null;\n  }\n}\n/**\n * @internal\n */\nexport async function getReadableFromProtocolStream(client, handle) {\n  // TODO: Once Node 18 becomes the lowest supported version, we can migrate to\n  // ReadableStream.\n  if (!isNode) {\n    throw new Error('Cannot create a stream outside of Node.js environment.');\n  }\n  const {\n    Readable\n  } = await import('stream');\n  let eof = false;\n  return new Readable({\n    async read(size) {\n      if (eof) {\n        return;\n      }\n      const response = await client.send('IO.read', {\n        handle,\n        size\n      });\n      this.push(response.data, response.base64Encoded ? 'base64' : undefined);\n      if (response.eof) {\n        eof = true;\n        await client.send('IO.close', {\n          handle\n        });\n        this.push(null);\n      }\n    }\n  });\n}\n/**\n * @internal\n */\nexport async function setPageContent(page, content) {\n  // We rely upon the fact that document.open() will reset frame lifecycle with \"init\"\n  // lifecycle event. @see https://crrev.com/608658\n  return page.evaluate(html => {\n    document.open();\n    document.write(html);\n    document.close();\n  }, content);\n}","map":{"version":3,"names":["isNode","assert","isErrorLike","debug","CDPElementHandle","TimeoutError","CDPJSHandle","debugError","getExceptionMessage","exceptionDetails","exception","description","value","message","text","stackTrace","callframe","callFrames","location","url","lineNumber","columnNumber","functionName","valueFromRemoteObject","remoteObject","objectId","unserializableValue","type","BigInt","replace","NaN","Infinity","Error","releaseObject","client","send","catch","error","addEventListener","emitter","eventName","handler","on","removeEventListeners","listeners","listener","removeListener","length","isString","obj","String","isNumber","Number","isPlainObject","constructor","Object","isRegExp","RegExp","isDate","Date","waitForEvent","predicate","timeout","abortPromise","eventTimeout","resolveCallback","rejectCallback","promise","Promise","resolve","reject","event","setTimeout","cleanup","clearTimeout","result","race","then","r","createJSHandle","context","subtype","_world","frame","evaluationString","fun","args","serializeArgument","arg","is","undefined","JSON","stringify","map","join","addPageBinding","name","callCDP","globalThis","assign","callPuppeteer","_a","Map","_b","callbacks","seq","_c","lastSeq","set","isTrivial","some","Node","delete","pageBindingInitString","waitWithTimeout","taskName","timeoutError","timeoutPromise","_","rej","timeoutTimer","fs","importFSPromises","TypeError","getReadableAsBuffer","readable","path","buffers","fileHandle","open","chunk","push","writeFile","close","Buffer","concat","getReadableFromProtocolStream","handle","Readable","eof","read","size","response","data","base64Encoded","setPageContent","page","content","evaluate","html","document","write"],"sources":["../../../../src/common/util.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}