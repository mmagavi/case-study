{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2022 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _FirefoxTargetManager_instances, _FirefoxTargetManager_connection, _FirefoxTargetManager_discoveredTargetsByTargetId, _FirefoxTargetManager_availableTargetsByTargetId, _FirefoxTargetManager_availableTargetsBySessionId, _FirefoxTargetManager_ignoredTargets, _FirefoxTargetManager_targetFilterCallback, _FirefoxTargetManager_targetFactory, _FirefoxTargetManager_targetInterceptors, _FirefoxTargetManager_attachedToTargetListenersBySession, _FirefoxTargetManager_initializePromise, _FirefoxTargetManager_targetsIdsForInit, _FirefoxTargetManager_onSessionDetached, _FirefoxTargetManager_onTargetCreated, _FirefoxTargetManager_onTargetDestroyed, _FirefoxTargetManager_onAttachedToTarget, _FirefoxTargetManager_finishInitializationIfReady;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FirefoxTargetManager = void 0;\nconst assert_js_1 = require(\"../util/assert.js\");\nconst DeferredPromise_js_1 = require(\"../util/DeferredPromise.js\");\nconst Connection_js_1 = require(\"./Connection.js\");\nconst EventEmitter_js_1 = require(\"./EventEmitter.js\");\n/**\n * FirefoxTargetManager implements target management using\n * `Target.setDiscoverTargets` without using auto-attach. It, therefore, creates\n * targets that lazily establish their CDP sessions.\n *\n * Although the approach is potentially flaky, there is no other way for Firefox\n * because Firefox's CDP implementation does not support auto-attach.\n *\n * Firefox does not support targetInfoChanged and detachedFromTarget events:\n *\n * - https://bugzilla.mozilla.org/show_bug.cgi?id=1610855\n * - https://bugzilla.mozilla.org/show_bug.cgi?id=1636979\n *   @internal\n */\nclass FirefoxTargetManager extends EventEmitter_js_1.EventEmitter {\n  constructor(connection, targetFactory, targetFilterCallback) {\n    super();\n    _FirefoxTargetManager_instances.add(this);\n    _FirefoxTargetManager_connection.set(this, void 0);\n    /**\n     * Keeps track of the following events: 'Target.targetCreated',\n     * 'Target.targetDestroyed'.\n     *\n     * A target becomes discovered when 'Target.targetCreated' is received.\n     * A target is removed from this map once 'Target.targetDestroyed' is\n     * received.\n     *\n     * `targetFilterCallback` has no effect on this map.\n     */\n    _FirefoxTargetManager_discoveredTargetsByTargetId.set(this, new Map());\n    /**\n     * Keeps track of targets that were created via 'Target.targetCreated'\n     * and which one are not filtered out by `targetFilterCallback`.\n     *\n     * The target is removed from here once it's been destroyed.\n     */\n    _FirefoxTargetManager_availableTargetsByTargetId.set(this, new Map());\n    /**\n     * Tracks which sessions attach to which target.\n     */\n    _FirefoxTargetManager_availableTargetsBySessionId.set(this, new Map());\n    /**\n     * If a target was filtered out by `targetFilterCallback`, we still receive\n     * events about it from CDP, but we don't forward them to the rest of Puppeteer.\n     */\n    _FirefoxTargetManager_ignoredTargets.set(this, new Set());\n    _FirefoxTargetManager_targetFilterCallback.set(this, void 0);\n    _FirefoxTargetManager_targetFactory.set(this, void 0);\n    _FirefoxTargetManager_targetInterceptors.set(this, new WeakMap());\n    _FirefoxTargetManager_attachedToTargetListenersBySession.set(this, new WeakMap());\n    _FirefoxTargetManager_initializePromise.set(this, (0, DeferredPromise_js_1.createDeferredPromise)());\n    _FirefoxTargetManager_targetsIdsForInit.set(this, new Set());\n    _FirefoxTargetManager_onSessionDetached.set(this, session => {\n      this.removeSessionListeners(session);\n      __classPrivateFieldGet(this, _FirefoxTargetManager_targetInterceptors, \"f\").delete(session);\n      __classPrivateFieldGet(this, _FirefoxTargetManager_availableTargetsBySessionId, \"f\").delete(session.id());\n    });\n    _FirefoxTargetManager_onTargetCreated.set(this, async event => {\n      if (__classPrivateFieldGet(this, _FirefoxTargetManager_discoveredTargetsByTargetId, \"f\").has(event.targetInfo.targetId)) {\n        return;\n      }\n      __classPrivateFieldGet(this, _FirefoxTargetManager_discoveredTargetsByTargetId, \"f\").set(event.targetInfo.targetId, event.targetInfo);\n      if (event.targetInfo.type === 'browser' && event.targetInfo.attached) {\n        const target = __classPrivateFieldGet(this, _FirefoxTargetManager_targetFactory, \"f\").call(this, event.targetInfo, undefined);\n        __classPrivateFieldGet(this, _FirefoxTargetManager_availableTargetsByTargetId, \"f\").set(event.targetInfo.targetId, target);\n        __classPrivateFieldGet(this, _FirefoxTargetManager_instances, \"m\", _FirefoxTargetManager_finishInitializationIfReady).call(this, target._targetId);\n        return;\n      }\n      if (__classPrivateFieldGet(this, _FirefoxTargetManager_targetFilterCallback, \"f\") && !__classPrivateFieldGet(this, _FirefoxTargetManager_targetFilterCallback, \"f\").call(this, event.targetInfo)) {\n        __classPrivateFieldGet(this, _FirefoxTargetManager_ignoredTargets, \"f\").add(event.targetInfo.targetId);\n        __classPrivateFieldGet(this, _FirefoxTargetManager_instances, \"m\", _FirefoxTargetManager_finishInitializationIfReady).call(this, event.targetInfo.targetId);\n        return;\n      }\n      const target = __classPrivateFieldGet(this, _FirefoxTargetManager_targetFactory, \"f\").call(this, event.targetInfo, undefined);\n      __classPrivateFieldGet(this, _FirefoxTargetManager_availableTargetsByTargetId, \"f\").set(event.targetInfo.targetId, target);\n      this.emit(\"targetAvailable\" /* TargetManagerEmittedEvents.TargetAvailable */, target);\n      __classPrivateFieldGet(this, _FirefoxTargetManager_instances, \"m\", _FirefoxTargetManager_finishInitializationIfReady).call(this, target._targetId);\n    });\n    _FirefoxTargetManager_onTargetDestroyed.set(this, event => {\n      __classPrivateFieldGet(this, _FirefoxTargetManager_discoveredTargetsByTargetId, \"f\").delete(event.targetId);\n      __classPrivateFieldGet(this, _FirefoxTargetManager_instances, \"m\", _FirefoxTargetManager_finishInitializationIfReady).call(this, event.targetId);\n      const target = __classPrivateFieldGet(this, _FirefoxTargetManager_availableTargetsByTargetId, \"f\").get(event.targetId);\n      if (target) {\n        this.emit(\"targetGone\" /* TargetManagerEmittedEvents.TargetGone */, target);\n        __classPrivateFieldGet(this, _FirefoxTargetManager_availableTargetsByTargetId, \"f\").delete(event.targetId);\n      }\n    });\n    _FirefoxTargetManager_onAttachedToTarget.set(this, async (parentSession, event) => {\n      const targetInfo = event.targetInfo;\n      const session = __classPrivateFieldGet(this, _FirefoxTargetManager_connection, \"f\").session(event.sessionId);\n      if (!session) {\n        throw new Error(`Session ${event.sessionId} was not created.`);\n      }\n      const target = __classPrivateFieldGet(this, _FirefoxTargetManager_availableTargetsByTargetId, \"f\").get(targetInfo.targetId);\n      (0, assert_js_1.assert)(target, `Target ${targetInfo.targetId} is missing`);\n      this.setupAttachmentListeners(session);\n      __classPrivateFieldGet(this, _FirefoxTargetManager_availableTargetsBySessionId, \"f\").set(session.id(), __classPrivateFieldGet(this, _FirefoxTargetManager_availableTargetsByTargetId, \"f\").get(targetInfo.targetId));\n      for (const hook of __classPrivateFieldGet(this, _FirefoxTargetManager_targetInterceptors, \"f\").get(parentSession) || []) {\n        if (!(parentSession instanceof Connection_js_1.Connection)) {\n          (0, assert_js_1.assert)(__classPrivateFieldGet(this, _FirefoxTargetManager_availableTargetsBySessionId, \"f\").has(parentSession.id()));\n        }\n        await hook(target, parentSession instanceof Connection_js_1.Connection ? null : __classPrivateFieldGet(this, _FirefoxTargetManager_availableTargetsBySessionId, \"f\").get(parentSession.id()));\n      }\n    });\n    __classPrivateFieldSet(this, _FirefoxTargetManager_connection, connection, \"f\");\n    __classPrivateFieldSet(this, _FirefoxTargetManager_targetFilterCallback, targetFilterCallback, \"f\");\n    __classPrivateFieldSet(this, _FirefoxTargetManager_targetFactory, targetFactory, \"f\");\n    __classPrivateFieldGet(this, _FirefoxTargetManager_connection, \"f\").on('Target.targetCreated', __classPrivateFieldGet(this, _FirefoxTargetManager_onTargetCreated, \"f\"));\n    __classPrivateFieldGet(this, _FirefoxTargetManager_connection, \"f\").on('Target.targetDestroyed', __classPrivateFieldGet(this, _FirefoxTargetManager_onTargetDestroyed, \"f\"));\n    __classPrivateFieldGet(this, _FirefoxTargetManager_connection, \"f\").on('sessiondetached', __classPrivateFieldGet(this, _FirefoxTargetManager_onSessionDetached, \"f\"));\n    this.setupAttachmentListeners(__classPrivateFieldGet(this, _FirefoxTargetManager_connection, \"f\"));\n  }\n  addTargetInterceptor(client, interceptor) {\n    const interceptors = __classPrivateFieldGet(this, _FirefoxTargetManager_targetInterceptors, \"f\").get(client) || [];\n    interceptors.push(interceptor);\n    __classPrivateFieldGet(this, _FirefoxTargetManager_targetInterceptors, \"f\").set(client, interceptors);\n  }\n  removeTargetInterceptor(client, interceptor) {\n    const interceptors = __classPrivateFieldGet(this, _FirefoxTargetManager_targetInterceptors, \"f\").get(client) || [];\n    __classPrivateFieldGet(this, _FirefoxTargetManager_targetInterceptors, \"f\").set(client, interceptors.filter(currentInterceptor => {\n      return currentInterceptor !== interceptor;\n    }));\n  }\n  setupAttachmentListeners(session) {\n    const listener = event => {\n      return __classPrivateFieldGet(this, _FirefoxTargetManager_onAttachedToTarget, \"f\").call(this, session, event);\n    };\n    (0, assert_js_1.assert)(!__classPrivateFieldGet(this, _FirefoxTargetManager_attachedToTargetListenersBySession, \"f\").has(session));\n    __classPrivateFieldGet(this, _FirefoxTargetManager_attachedToTargetListenersBySession, \"f\").set(session, listener);\n    session.on('Target.attachedToTarget', listener);\n  }\n  removeSessionListeners(session) {\n    if (__classPrivateFieldGet(this, _FirefoxTargetManager_attachedToTargetListenersBySession, \"f\").has(session)) {\n      session.off('Target.attachedToTarget', __classPrivateFieldGet(this, _FirefoxTargetManager_attachedToTargetListenersBySession, \"f\").get(session));\n      __classPrivateFieldGet(this, _FirefoxTargetManager_attachedToTargetListenersBySession, \"f\").delete(session);\n    }\n  }\n  getAvailableTargets() {\n    return __classPrivateFieldGet(this, _FirefoxTargetManager_availableTargetsByTargetId, \"f\");\n  }\n  dispose() {\n    __classPrivateFieldGet(this, _FirefoxTargetManager_connection, \"f\").off('Target.targetCreated', __classPrivateFieldGet(this, _FirefoxTargetManager_onTargetCreated, \"f\"));\n    __classPrivateFieldGet(this, _FirefoxTargetManager_connection, \"f\").off('Target.targetDestroyed', __classPrivateFieldGet(this, _FirefoxTargetManager_onTargetDestroyed, \"f\"));\n  }\n  async initialize() {\n    await __classPrivateFieldGet(this, _FirefoxTargetManager_connection, \"f\").send('Target.setDiscoverTargets', {\n      discover: true,\n      filter: [{}]\n    });\n    __classPrivateFieldSet(this, _FirefoxTargetManager_targetsIdsForInit, new Set(__classPrivateFieldGet(this, _FirefoxTargetManager_discoveredTargetsByTargetId, \"f\").keys()), \"f\");\n    await __classPrivateFieldGet(this, _FirefoxTargetManager_initializePromise, \"f\");\n  }\n}\nexports.FirefoxTargetManager = FirefoxTargetManager;\n_FirefoxTargetManager_connection = new WeakMap(), _FirefoxTargetManager_discoveredTargetsByTargetId = new WeakMap(), _FirefoxTargetManager_availableTargetsByTargetId = new WeakMap(), _FirefoxTargetManager_availableTargetsBySessionId = new WeakMap(), _FirefoxTargetManager_ignoredTargets = new WeakMap(), _FirefoxTargetManager_targetFilterCallback = new WeakMap(), _FirefoxTargetManager_targetFactory = new WeakMap(), _FirefoxTargetManager_targetInterceptors = new WeakMap(), _FirefoxTargetManager_attachedToTargetListenersBySession = new WeakMap(), _FirefoxTargetManager_initializePromise = new WeakMap(), _FirefoxTargetManager_targetsIdsForInit = new WeakMap(), _FirefoxTargetManager_onSessionDetached = new WeakMap(), _FirefoxTargetManager_onTargetCreated = new WeakMap(), _FirefoxTargetManager_onTargetDestroyed = new WeakMap(), _FirefoxTargetManager_onAttachedToTarget = new WeakMap(), _FirefoxTargetManager_instances = new WeakSet(), _FirefoxTargetManager_finishInitializationIfReady = function _FirefoxTargetManager_finishInitializationIfReady(targetId) {\n  __classPrivateFieldGet(this, _FirefoxTargetManager_targetsIdsForInit, \"f\").delete(targetId);\n  if (__classPrivateFieldGet(this, _FirefoxTargetManager_targetsIdsForInit, \"f\").size === 0) {\n    __classPrivateFieldGet(this, _FirefoxTargetManager_initializePromise, \"f\").resolve();\n  }\n};","map":{"version":3,"names":["assert_js_1","require","DeferredPromise_js_1","Connection_js_1","EventEmitter_js_1","FirefoxTargetManager","EventEmitter","constructor","connection","targetFactory","targetFilterCallback","_FirefoxTargetManager_connection","set","_FirefoxTargetManager_discoveredTargetsByTargetId","Map","_FirefoxTargetManager_availableTargetsByTargetId","_FirefoxTargetManager_availableTargetsBySessionId","_FirefoxTargetManager_ignoredTargets","Set","_FirefoxTargetManager_targetFilterCallback","_FirefoxTargetManager_targetFactory","_FirefoxTargetManager_targetInterceptors","WeakMap","_FirefoxTargetManager_attachedToTargetListenersBySession","_FirefoxTargetManager_initializePromise","createDeferredPromise","_FirefoxTargetManager_targetsIdsForInit","_FirefoxTargetManager_onSessionDetached","session","removeSessionListeners","__classPrivateFieldGet","delete","id","_FirefoxTargetManager_onTargetCreated","event","has","targetInfo","targetId","type","attached","target","call","undefined","_FirefoxTargetManager_instances","_FirefoxTargetManager_finishInitializationIfReady","_targetId","add","emit","_FirefoxTargetManager_onTargetDestroyed","get","_FirefoxTargetManager_onAttachedToTarget","parentSession","sessionId","Error","assert","setupAttachmentListeners","hook","Connection","__classPrivateFieldSet","on","addTargetInterceptor","client","interceptor","interceptors","push","removeTargetInterceptor","filter","currentInterceptor","listener","off","getAvailableTargets","dispose","initialize","send","discover","keys","exports","size","resolve"],"sources":["../../../../src/common/FirefoxTargetManager.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}