{"ast":null,"code":"\"use strict\";\n\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _PipeTransport_instances, _PipeTransport_pipeWrite, _PipeTransport_eventListeners, _PipeTransport_isClosed, _PipeTransport_pendingMessage, _PipeTransport_dispatch;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PipeTransport = void 0;\nconst util_js_1 = require(\"../common/util.js\");\nconst assert_js_1 = require(\"../util/assert.js\");\n/**\n * @internal\n */\nclass PipeTransport {\n  constructor(pipeWrite, pipeRead) {\n    _PipeTransport_instances.add(this);\n    _PipeTransport_pipeWrite.set(this, void 0);\n    _PipeTransport_eventListeners.set(this, void 0);\n    _PipeTransport_isClosed.set(this, false);\n    _PipeTransport_pendingMessage.set(this, '');\n    __classPrivateFieldSet(this, _PipeTransport_pipeWrite, pipeWrite, \"f\");\n    __classPrivateFieldSet(this, _PipeTransport_eventListeners, [(0, util_js_1.addEventListener)(pipeRead, 'data', buffer => {\n      return __classPrivateFieldGet(this, _PipeTransport_instances, \"m\", _PipeTransport_dispatch).call(this, buffer);\n    }), (0, util_js_1.addEventListener)(pipeRead, 'close', () => {\n      if (this.onclose) {\n        this.onclose.call(null);\n      }\n    }), (0, util_js_1.addEventListener)(pipeRead, 'error', util_js_1.debugError), (0, util_js_1.addEventListener)(pipeWrite, 'error', util_js_1.debugError)], \"f\");\n  }\n  send(message) {\n    (0, assert_js_1.assert)(!__classPrivateFieldGet(this, _PipeTransport_isClosed, \"f\"), '`PipeTransport` is closed.');\n    __classPrivateFieldGet(this, _PipeTransport_pipeWrite, \"f\").write(message);\n    __classPrivateFieldGet(this, _PipeTransport_pipeWrite, \"f\").write('\\0');\n  }\n  close() {\n    __classPrivateFieldSet(this, _PipeTransport_isClosed, true, \"f\");\n    (0, util_js_1.removeEventListeners)(__classPrivateFieldGet(this, _PipeTransport_eventListeners, \"f\"));\n  }\n}\nexports.PipeTransport = PipeTransport;\n_PipeTransport_pipeWrite = new WeakMap(), _PipeTransport_eventListeners = new WeakMap(), _PipeTransport_isClosed = new WeakMap(), _PipeTransport_pendingMessage = new WeakMap(), _PipeTransport_instances = new WeakSet(), _PipeTransport_dispatch = function _PipeTransport_dispatch(buffer) {\n  (0, assert_js_1.assert)(!__classPrivateFieldGet(this, _PipeTransport_isClosed, \"f\"), '`PipeTransport` is closed.');\n  let end = buffer.indexOf('\\0');\n  if (end === -1) {\n    __classPrivateFieldSet(this, _PipeTransport_pendingMessage, __classPrivateFieldGet(this, _PipeTransport_pendingMessage, \"f\") + buffer.toString(), \"f\");\n    return;\n  }\n  const message = __classPrivateFieldGet(this, _PipeTransport_pendingMessage, \"f\") + buffer.toString(undefined, 0, end);\n  if (this.onmessage) {\n    this.onmessage.call(null, message);\n  }\n  let start = end + 1;\n  end = buffer.indexOf('\\0', start);\n  while (end !== -1) {\n    if (this.onmessage) {\n      this.onmessage.call(null, buffer.toString(undefined, start, end));\n    }\n    start = end + 1;\n    end = buffer.indexOf('\\0', start);\n  }\n  __classPrivateFieldSet(this, _PipeTransport_pendingMessage, buffer.toString(undefined, start), \"f\");\n};","map":{"version":3,"names":["util_js_1","require","assert_js_1","PipeTransport","constructor","pipeWrite","pipeRead","_PipeTransport_pipeWrite","set","_PipeTransport_eventListeners","_PipeTransport_isClosed","_PipeTransport_pendingMessage","__classPrivateFieldSet","addEventListener","buffer","__classPrivateFieldGet","_PipeTransport_instances","_PipeTransport_dispatch","call","onclose","debugError","send","message","assert","write","close","removeEventListeners","exports","end","indexOf","toString","undefined","onmessage","start"],"sources":["../../../../src/node/PipeTransport.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}