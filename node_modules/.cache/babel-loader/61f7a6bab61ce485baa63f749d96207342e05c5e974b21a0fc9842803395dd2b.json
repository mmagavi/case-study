{"ast":null,"code":"var __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _Tracing_client, _Tracing_recording, _Tracing_path;\n/**\n * Copyright 2017 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assert } from '../util/assert.js';\nimport { isErrorLike } from '../util/ErrorLike.js';\nimport { getReadableAsBuffer, getReadableFromProtocolStream } from './util.js';\n/**\n * The Tracing class exposes the tracing audit interface.\n * @remarks\n * You can use `tracing.start` and `tracing.stop` to create a trace file\n * which can be opened in Chrome DevTools or {@link https://chromedevtools.github.io/timeline-viewer/ | timeline viewer}.\n *\n * @example\n *\n * ```ts\n * await page.tracing.start({path: 'trace.json'});\n * await page.goto('https://www.google.com');\n * await page.tracing.stop();\n * ```\n *\n * @public\n */\nexport class Tracing {\n  /**\n   * @internal\n   */\n  constructor(client) {\n    _Tracing_client.set(this, void 0);\n    _Tracing_recording.set(this, false);\n    _Tracing_path.set(this, void 0);\n    __classPrivateFieldSet(this, _Tracing_client, client, \"f\");\n  }\n  /**\n   * Starts a trace for the current page.\n   * @remarks\n   * Only one trace can be active at a time per browser.\n   *\n   * @param options - Optional `TracingOptions`.\n   */\n  async start(options = {}) {\n    assert(!__classPrivateFieldGet(this, _Tracing_recording, \"f\"), 'Cannot start recording trace while already recording trace.');\n    const defaultCategories = ['-*', 'devtools.timeline', 'v8.execute', 'disabled-by-default-devtools.timeline', 'disabled-by-default-devtools.timeline.frame', 'toplevel', 'blink.console', 'blink.user_timing', 'latencyInfo', 'disabled-by-default-devtools.timeline.stack', 'disabled-by-default-v8.cpu_profiler'];\n    const {\n      path,\n      screenshots = false,\n      categories = defaultCategories\n    } = options;\n    if (screenshots) {\n      categories.push('disabled-by-default-devtools.screenshot');\n    }\n    const excludedCategories = categories.filter(cat => {\n      return cat.startsWith('-');\n    }).map(cat => {\n      return cat.slice(1);\n    });\n    const includedCategories = categories.filter(cat => {\n      return !cat.startsWith('-');\n    });\n    __classPrivateFieldSet(this, _Tracing_path, path, \"f\");\n    __classPrivateFieldSet(this, _Tracing_recording, true, \"f\");\n    await __classPrivateFieldGet(this, _Tracing_client, \"f\").send('Tracing.start', {\n      transferMode: 'ReturnAsStream',\n      traceConfig: {\n        excludedCategories,\n        includedCategories\n      }\n    });\n  }\n  /**\n   * Stops a trace started with the `start` method.\n   * @returns Promise which resolves to buffer with trace data.\n   */\n  async stop() {\n    let resolve;\n    let reject;\n    const contentPromise = new Promise((x, y) => {\n      resolve = x;\n      reject = y;\n    });\n    __classPrivateFieldGet(this, _Tracing_client, \"f\").once('Tracing.tracingComplete', async event => {\n      try {\n        const readable = await getReadableFromProtocolStream(__classPrivateFieldGet(this, _Tracing_client, \"f\"), event.stream);\n        const buffer = await getReadableAsBuffer(readable, __classPrivateFieldGet(this, _Tracing_path, \"f\"));\n        resolve(buffer !== null && buffer !== void 0 ? buffer : undefined);\n      } catch (error) {\n        if (isErrorLike(error)) {\n          reject(error);\n        } else {\n          reject(new Error(`Unknown error: ${error}`));\n        }\n      }\n    });\n    await __classPrivateFieldGet(this, _Tracing_client, \"f\").send('Tracing.end');\n    __classPrivateFieldSet(this, _Tracing_recording, false, \"f\");\n    return contentPromise;\n  }\n}\n_Tracing_client = new WeakMap(), _Tracing_recording = new WeakMap(), _Tracing_path = new WeakMap();","map":{"version":3,"names":["assert","isErrorLike","getReadableAsBuffer","getReadableFromProtocolStream","Tracing","constructor","client","_Tracing_client","set","_Tracing_recording","_Tracing_path","__classPrivateFieldSet","start","options","__classPrivateFieldGet","defaultCategories","path","screenshots","categories","push","excludedCategories","filter","cat","startsWith","map","slice","includedCategories","send","transferMode","traceConfig","stop","resolve","reject","contentPromise","Promise","x","y","once","event","readable","stream","buffer","undefined","error","Error"],"sources":["../../../../src/common/Tracing.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;AAeA,SAAQA,MAAM,QAAO,mBAAmB;AACxC,SAAQC,WAAW,QAAO,sBAAsB;AAGhD,SAAQC,mBAAmB,EAAEC,6BAA6B,QAAO,WAAW;AAW5E;;;;;;;;;;;;;;;;AAgBA,OAAM,MAAOC,OAAO;EAKlB;;;EAGAC,YAAYC,MAAkB;IAP9BC,eAAA,CAAAC,GAAA;IACAC,kBAAA,CAAAD,GAAA,OAAa,KAAK;IAClBE,aAAA,CAAAF,GAAA;IAMEG,sBAAA,KAAI,EAAAJ,eAAA,EAAWD,MAAM;EACvB;EAEA;;;;;;;EAOA,MAAMM,KAAKA,CAACC,OAAA,GAA0B,EAAE;IACtCb,MAAM,CACJ,CAACc,sBAAA,KAAI,EAAAL,kBAAA,MAAW,EAChB,6DAA6D,CAC9D;IAED,MAAMM,iBAAiB,GAAG,CACxB,IAAI,EACJ,mBAAmB,EACnB,YAAY,EACZ,uCAAuC,EACvC,6CAA6C,EAC7C,UAAU,EACV,eAAe,EACf,mBAAmB,EACnB,aAAa,EACb,6CAA6C,EAC7C,qCAAqC,CACtC;IACD,MAAM;MAACC,IAAI;MAAEC,WAAW,GAAG,KAAK;MAAEC,UAAU,GAAGH;IAAiB,CAAC,GAAGF,OAAO;IAE3E,IAAII,WAAW,EAAE;MACfC,UAAU,CAACC,IAAI,CAAC,yCAAyC,CAAC;;IAG5D,MAAMC,kBAAkB,GAAGF,UAAU,CAClCG,MAAM,CAACC,GAAG,IAAG;MACZ,OAAOA,GAAG,CAACC,UAAU,CAAC,GAAG,CAAC;IAC5B,CAAC,CAAC,CACDC,GAAG,CAACF,GAAG,IAAG;MACT,OAAOA,GAAG,CAACG,KAAK,CAAC,CAAC,CAAC;IACrB,CAAC,CAAC;IACJ,MAAMC,kBAAkB,GAAGR,UAAU,CAACG,MAAM,CAACC,GAAG,IAAG;MACjD,OAAO,CAACA,GAAG,CAACC,UAAU,CAAC,GAAG,CAAC;IAC7B,CAAC,CAAC;IAEFZ,sBAAA,KAAI,EAAAD,aAAA,EAASM,IAAI;IACjBL,sBAAA,KAAI,EAAAF,kBAAA,EAAc,IAAI;IACtB,MAAMK,sBAAA,KAAI,EAAAP,eAAA,MAAQ,CAACoB,IAAI,CAAC,eAAe,EAAE;MACvCC,YAAY,EAAE,gBAAgB;MAC9BC,WAAW,EAAE;QACXT,kBAAkB;QAClBM;;KAEH,CAAC;EACJ;EAEA;;;;EAIA,MAAMI,IAAIA,CAAA;IACR,IAAIC,OAA4C;IAChD,IAAIC,MAA4B;IAChC,MAAMC,cAAc,GAAG,IAAIC,OAAO,CAAqB,CAACC,CAAC,EAAEC,CAAC,KAAI;MAC9DL,OAAO,GAAGI,CAAC;MACXH,MAAM,GAAGI,CAAC;IACZ,CAAC,CAAC;IACFtB,sBAAA,KAAI,EAAAP,eAAA,MAAQ,CAAC8B,IAAI,CAAC,yBAAyB,EAAE,MAAMC,KAAK,IAAG;MACzD,IAAI;QACF,MAAMC,QAAQ,GAAG,MAAMpC,6BAA6B,CAClDW,sBAAA,KAAI,EAAAP,eAAA,MAAQ,EACZ+B,KAAK,CAACE,MAAM,CACb;QACD,MAAMC,MAAM,GAAG,MAAMvC,mBAAmB,CAACqC,QAAQ,EAAEzB,sBAAA,KAAI,EAAAJ,aAAA,MAAM,CAAC;QAC9DqB,OAAO,CAACU,MAAM,aAANA,MAAM,cAANA,MAAM,GAAIC,SAAS,CAAC;OAC7B,CAAC,OAAOC,KAAK,EAAE;QACd,IAAI1C,WAAW,CAAC0C,KAAK,CAAC,EAAE;UACtBX,MAAM,CAACW,KAAK,CAAC;SACd,MAAM;UACLX,MAAM,CAAC,IAAIY,KAAK,CAAC,kBAAkBD,KAAK,EAAE,CAAC,CAAC;;;IAGlD,CAAC,CAAC;IACF,MAAM7B,sBAAA,KAAI,EAAAP,eAAA,MAAQ,CAACoB,IAAI,CAAC,aAAa,CAAC;IACtChB,sBAAA,KAAI,EAAAF,kBAAA,EAAc,KAAK;IACvB,OAAOwB,cAAc;EACvB"},"metadata":{},"sourceType":"module","externalDependencies":[]}