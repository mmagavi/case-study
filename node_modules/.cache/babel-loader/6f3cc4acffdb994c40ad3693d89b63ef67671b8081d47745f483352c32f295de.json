{"ast":null,"code":"/**\n * Copyright 2019 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar _IsolatedWorld_instances, _IsolatedWorld_frame, _IsolatedWorld_document, _IsolatedWorld_context, _IsolatedWorld_detached, _IsolatedWorld_contextBindings, _IsolatedWorld_bindings, _IsolatedWorld_taskManager, _IsolatedWorld_client_get, _IsolatedWorld_frameManager_get, _IsolatedWorld_timeoutSettings_get, _IsolatedWorld_mutex, _IsolatedWorld_onBindingCalled, _Mutex_locked, _Mutex_acquirers;\nimport { assert } from '../util/assert.js';\nimport { createDeferredPromise } from '../util/DeferredPromise.js';\nimport { MAIN_WORLD, PUPPETEER_WORLD } from './IsolatedWorlds.js';\nimport { LifecycleWatcher } from './LifecycleWatcher.js';\nimport { addPageBinding, createJSHandle, debugError, setPageContent } from './util.js';\nimport { TaskManager, WaitTask } from './WaitTask.js';\n/**\n * @internal\n */\nexport class IsolatedWorld {\n  get taskManager() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\");\n  }\n  get _bindings() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_bindings, \"f\");\n  }\n  constructor(frame) {\n    _IsolatedWorld_instances.add(this);\n    _IsolatedWorld_frame.set(this, void 0);\n    _IsolatedWorld_document.set(this, void 0);\n    _IsolatedWorld_context.set(this, createDeferredPromise());\n    _IsolatedWorld_detached.set(this, false);\n    // Set of bindings that have been registered in the current context.\n    _IsolatedWorld_contextBindings.set(this, new Set());\n    // Contains mapping from functions that should be bound to Puppeteer functions.\n    _IsolatedWorld_bindings.set(this, new Map());\n    _IsolatedWorld_taskManager.set(this, new TaskManager());\n    // If multiple waitFor are set up asynchronously, we need to wait for the\n    // first one to set up the binding in the page before running the others.\n    _IsolatedWorld_mutex.set(this, new Mutex());\n    _IsolatedWorld_onBindingCalled.set(this, async event => {\n      let payload;\n      try {\n        payload = JSON.parse(event.payload);\n      } catch {\n        // The binding was either called by something in the page or it was\n        // called before our wrapper was initialized.\n        return;\n      }\n      const {\n        type,\n        name,\n        seq,\n        args,\n        isTrivial\n      } = payload;\n      if (type !== 'internal') {\n        return;\n      }\n      if (!__classPrivateFieldGet(this, _IsolatedWorld_contextBindings, \"f\").has(name)) {\n        return;\n      }\n      const context = await __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\");\n      if (event.executionContextId !== context._contextId) {\n        return;\n      }\n      const binding = this._bindings.get(name);\n      await (binding === null || binding === void 0 ? void 0 : binding.run(context, seq, args, isTrivial));\n    });\n    // Keep own reference to client because it might differ from the FrameManager's\n    // client for OOP iframes.\n    __classPrivateFieldSet(this, _IsolatedWorld_frame, frame, \"f\");\n    __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).on('Runtime.bindingCalled', __classPrivateFieldGet(this, _IsolatedWorld_onBindingCalled, \"f\"));\n  }\n  frame() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\");\n  }\n  clearContext() {\n    __classPrivateFieldSet(this, _IsolatedWorld_document, undefined, \"f\");\n    __classPrivateFieldSet(this, _IsolatedWorld_context, createDeferredPromise(), \"f\");\n  }\n  setContext(context) {\n    __classPrivateFieldGet(this, _IsolatedWorld_contextBindings, \"f\").clear();\n    __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\").resolve(context);\n    __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\").rerunAll();\n  }\n  hasContext() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\").resolved();\n  }\n  _detach() {\n    __classPrivateFieldSet(this, _IsolatedWorld_detached, true, \"f\");\n    __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).off('Runtime.bindingCalled', __classPrivateFieldGet(this, _IsolatedWorld_onBindingCalled, \"f\"));\n    __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\").terminateAll(new Error('waitForFunction failed: frame got detached.'));\n  }\n  executionContext() {\n    if (__classPrivateFieldGet(this, _IsolatedWorld_detached, \"f\")) {\n      throw new Error(`Execution context is not available in detached frame \"${__classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\").url()}\" (are you trying to evaluate?)`);\n    }\n    if (__classPrivateFieldGet(this, _IsolatedWorld_context, \"f\") === null) {\n      throw new Error(`Execution content promise is missing`);\n    }\n    return __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\");\n  }\n  async evaluateHandle(pageFunction, ...args) {\n    const context = await this.executionContext();\n    return context.evaluateHandle(pageFunction, ...args);\n  }\n  async evaluate(pageFunction, ...args) {\n    const context = await this.executionContext();\n    return context.evaluate(pageFunction, ...args);\n  }\n  async $(selector) {\n    const document = await this.document();\n    return document.$(selector);\n  }\n  async $$(selector) {\n    const document = await this.document();\n    return document.$$(selector);\n  }\n  async document() {\n    if (__classPrivateFieldGet(this, _IsolatedWorld_document, \"f\")) {\n      return __classPrivateFieldGet(this, _IsolatedWorld_document, \"f\");\n    }\n    const context = await this.executionContext();\n    __classPrivateFieldSet(this, _IsolatedWorld_document, await context.evaluateHandle(() => {\n      return document;\n    }), \"f\");\n    return __classPrivateFieldGet(this, _IsolatedWorld_document, \"f\");\n  }\n  async $x(expression) {\n    const document = await this.document();\n    return document.$x(expression);\n  }\n  async $eval(selector, pageFunction, ...args) {\n    const document = await this.document();\n    return document.$eval(selector, pageFunction, ...args);\n  }\n  async $$eval(selector, pageFunction, ...args) {\n    const document = await this.document();\n    return document.$$eval(selector, pageFunction, ...args);\n  }\n  async content() {\n    return await this.evaluate(() => {\n      let retVal = '';\n      if (document.doctype) {\n        retVal = new XMLSerializer().serializeToString(document.doctype);\n      }\n      if (document.documentElement) {\n        retVal += document.documentElement.outerHTML;\n      }\n      return retVal;\n    });\n  }\n  async setContent(html, options = {}) {\n    const {\n      waitUntil = ['load'],\n      timeout = __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_timeoutSettings_get).navigationTimeout()\n    } = options;\n    await setPageContent(this, html);\n    const watcher = new LifecycleWatcher(__classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_frameManager_get), __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\"), waitUntil, timeout);\n    const error = await Promise.race([watcher.timeoutOrTerminationPromise(), watcher.lifecyclePromise()]);\n    watcher.dispose();\n    if (error) {\n      throw error;\n    }\n  }\n  async click(selector, options = {}) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.click(options);\n    await handle.dispose();\n  }\n  async focus(selector) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.focus();\n    await handle.dispose();\n  }\n  async hover(selector) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.hover();\n    await handle.dispose();\n  }\n  async select(selector, ...values) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    const result = await handle.select(...values);\n    await handle.dispose();\n    return result;\n  }\n  async tap(selector) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.tap();\n    await handle.dispose();\n  }\n  async type(selector, text, options) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.type(text, options);\n    await handle.dispose();\n  }\n  async _addBindingToContext(context, name) {\n    if (__classPrivateFieldGet(this, _IsolatedWorld_contextBindings, \"f\").has(name)) {\n      return;\n    }\n    await __classPrivateFieldGet(this, _IsolatedWorld_mutex, \"f\").acquire();\n    try {\n      await context._client.send('Runtime.addBinding', {\n        name,\n        executionContextName: context._contextName\n      });\n      await context.evaluate(addPageBinding, 'internal', name);\n      __classPrivateFieldGet(this, _IsolatedWorld_contextBindings, \"f\").add(name);\n    } catch (error) {\n      // We could have tried to evaluate in a context which was already\n      // destroyed. This happens, for example, if the page is navigated while\n      // we are trying to add the binding\n      if (error instanceof Error) {\n        // Destroyed context.\n        if (error.message.includes('Execution context was destroyed')) {\n          return;\n        }\n        // Missing context.\n        if (error.message.includes('Cannot find context with specified id')) {\n          return;\n        }\n      }\n      debugError(error);\n    } finally {\n      __classPrivateFieldGet(this, _IsolatedWorld_mutex, \"f\").release();\n    }\n  }\n  waitForFunction(pageFunction, options = {}, ...args) {\n    const {\n      polling = 'raf',\n      timeout = __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_timeoutSettings_get).timeout(),\n      root,\n      signal\n    } = options;\n    if (typeof polling === 'number' && polling < 0) {\n      throw new Error('Cannot poll with non-positive interval');\n    }\n    const waitTask = new WaitTask(this, {\n      polling,\n      root,\n      timeout,\n      signal\n    }, pageFunction, ...args);\n    return waitTask.result;\n  }\n  async title() {\n    return this.evaluate(() => {\n      return document.title;\n    });\n  }\n  async adoptBackendNode(backendNodeId) {\n    const executionContext = await this.executionContext();\n    const {\n      object\n    } = await __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).send('DOM.resolveNode', {\n      backendNodeId: backendNodeId,\n      executionContextId: executionContext._contextId\n    });\n    return createJSHandle(executionContext, object);\n  }\n  async adoptHandle(handle) {\n    const context = await this.executionContext();\n    assert(handle.executionContext() !== context, 'Cannot adopt handle that already belongs to this execution context');\n    const nodeInfo = await __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).send('DOM.describeNode', {\n      objectId: handle.id\n    });\n    return await this.adoptBackendNode(nodeInfo.node.backendNodeId);\n  }\n  async transferHandle(handle) {\n    const context = await this.executionContext();\n    if (handle.executionContext() === context) {\n      return handle;\n    }\n    const info = await __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).send('DOM.describeNode', {\n      objectId: handle.remoteObject().objectId\n    });\n    const newHandle = await this.adoptBackendNode(info.node.backendNodeId);\n    await handle.dispose();\n    return newHandle;\n  }\n}\n_IsolatedWorld_frame = new WeakMap(), _IsolatedWorld_document = new WeakMap(), _IsolatedWorld_context = new WeakMap(), _IsolatedWorld_detached = new WeakMap(), _IsolatedWorld_contextBindings = new WeakMap(), _IsolatedWorld_bindings = new WeakMap(), _IsolatedWorld_taskManager = new WeakMap(), _IsolatedWorld_mutex = new WeakMap(), _IsolatedWorld_onBindingCalled = new WeakMap(), _IsolatedWorld_instances = new WeakSet(), _IsolatedWorld_client_get = function _IsolatedWorld_client_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\")._client();\n}, _IsolatedWorld_frameManager_get = function _IsolatedWorld_frameManager_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\")._frameManager;\n}, _IsolatedWorld_timeoutSettings_get = function _IsolatedWorld_timeoutSettings_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_frameManager_get).timeoutSettings;\n};\nclass Mutex {\n  constructor() {\n    _Mutex_locked.set(this, false);\n    _Mutex_acquirers.set(this, []);\n  }\n  // This is FIFO.\n  acquire() {\n    if (!__classPrivateFieldGet(this, _Mutex_locked, \"f\")) {\n      __classPrivateFieldSet(this, _Mutex_locked, true, \"f\");\n      return Promise.resolve();\n    }\n    let resolve;\n    const promise = new Promise(res => {\n      resolve = res;\n    });\n    __classPrivateFieldGet(this, _Mutex_acquirers, \"f\").push(resolve);\n    return promise;\n  }\n  release() {\n    const resolve = __classPrivateFieldGet(this, _Mutex_acquirers, \"f\").shift();\n    if (!resolve) {\n      __classPrivateFieldSet(this, _Mutex_locked, false, \"f\");\n      return;\n    }\n    resolve();\n  }\n}\n_Mutex_locked = new WeakMap(), _Mutex_acquirers = new WeakMap();","map":{"version":3,"names":["assert","createDeferredPromise","MAIN_WORLD","PUPPETEER_WORLD","LifecycleWatcher","addPageBinding","createJSHandle","debugError","setPageContent","TaskManager","WaitTask","IsolatedWorld","taskManager","__classPrivateFieldGet","_IsolatedWorld_taskManager","_bindings","_IsolatedWorld_bindings","constructor","frame","_IsolatedWorld_frame","set","_IsolatedWorld_document","_IsolatedWorld_context","_IsolatedWorld_detached","_IsolatedWorld_contextBindings","Set","Map","_IsolatedWorld_mutex","Mutex","_IsolatedWorld_onBindingCalled","event","payload","JSON","parse","type","name","seq","args","isTrivial","has","context","executionContextId","_contextId","binding","get","run","__classPrivateFieldSet","_IsolatedWorld_instances","_IsolatedWorld_client_get","on","clearContext","undefined","setContext","clear","resolve","rerunAll","hasContext","resolved","_detach","off","terminateAll","Error","executionContext","url","evaluateHandle","pageFunction","evaluate","$","selector","document","$$","$x","expression","$eval","$$eval","content","retVal","doctype","XMLSerializer","serializeToString","documentElement","outerHTML","setContent","html","options","waitUntil","timeout","_IsolatedWorld_timeoutSettings_get","navigationTimeout","watcher","_IsolatedWorld_frameManager_get","error","Promise","race","timeoutOrTerminationPromise","lifecyclePromise","dispose","click","handle","focus","hover","select","values","result","tap","text","_addBindingToContext","acquire","_client","send","executionContextName","_contextName","add","message","includes","release","waitForFunction","polling","root","signal","waitTask","title","adoptBackendNode","backendNodeId","object","adoptHandle","nodeInfo","objectId","id","node","transferHandle","info","remoteObject","newHandle","_frameManager","timeoutSettings","_Mutex_locked","_Mutex_acquirers","promise","res","push","shift"],"sources":["../../../../src/common/IsolatedWorld.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}