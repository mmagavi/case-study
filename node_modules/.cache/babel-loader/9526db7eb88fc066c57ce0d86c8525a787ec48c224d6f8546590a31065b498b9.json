{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2023 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ChromeLauncher = void 0;\nconst promises_1 = require(\"fs/promises\");\nconst path_1 = __importDefault(require(\"path\"));\nconst browsers_1 = require(\"@puppeteer/browsers\");\nconst util_js_1 = require(\"../common/util.js\");\nconst assert_js_1 = require(\"../util/assert.js\");\nconst ProductLauncher_js_1 = require(\"./ProductLauncher.js\");\nconst fs_js_1 = require(\"./util/fs.js\");\n/**\n * @internal\n */\nclass ChromeLauncher extends ProductLauncher_js_1.ProductLauncher {\n  constructor(puppeteer) {\n    super(puppeteer, 'chrome');\n  }\n  launch(options = {}) {\n    var _a;\n    const headless = (_a = options.headless) !== null && _a !== void 0 ? _a : true;\n    if (headless === true && (!this.puppeteer.configuration.logLevel || this.puppeteer.configuration.logLevel === 'warn') && !Boolean(process.env['PUPPETEER_DISABLE_HEADLESS_WARNING'])) {\n      console.warn(['\\x1B[1m\\x1B[43m\\x1B[30m', 'Puppeteer old Headless deprecation warning:\\x1B[0m\\x1B[33m', '  In the near feature `headless: true` will default to the new Headless mode', '  for Chrome instead of the old Headless implementation. For more', '  information, please see https://developer.chrome.com/articles/new-headless/.', '  Consider opting in early by passing `headless: \"new\"` to `puppeteer.launch()`', '  If you encounter any bugs, please report them to https://github.com/puppeteer/puppeteer/issues/new/choose.\\x1B[0m\\n'].join('\\n  '));\n    }\n    return super.launch(options);\n  }\n  /**\n   * @internal\n   */\n  async computeLaunchArguments(options = {}) {\n    const {\n      ignoreDefaultArgs = false,\n      args = [],\n      pipe = false,\n      debuggingPort,\n      channel,\n      executablePath\n    } = options;\n    const chromeArguments = [];\n    if (!ignoreDefaultArgs) {\n      chromeArguments.push(...this.defaultArgs(options));\n    } else if (Array.isArray(ignoreDefaultArgs)) {\n      chromeArguments.push(...this.defaultArgs(options).filter(arg => {\n        return !ignoreDefaultArgs.includes(arg);\n      }));\n    } else {\n      chromeArguments.push(...args);\n    }\n    if (!chromeArguments.some(argument => {\n      return argument.startsWith('--remote-debugging-');\n    })) {\n      if (pipe) {\n        (0, assert_js_1.assert)(!debuggingPort, 'Browser should be launched with either pipe or debugging port - not both.');\n        chromeArguments.push('--remote-debugging-pipe');\n      } else {\n        chromeArguments.push(`--remote-debugging-port=${debuggingPort || 0}`);\n      }\n    }\n    let isTempUserDataDir = false;\n    // Check for the user data dir argument, which will always be set even\n    // with a custom directory specified via the userDataDir option.\n    let userDataDirIndex = chromeArguments.findIndex(arg => {\n      return arg.startsWith('--user-data-dir');\n    });\n    if (userDataDirIndex < 0) {\n      isTempUserDataDir = true;\n      chromeArguments.push(`--user-data-dir=${await (0, promises_1.mkdtemp)(this.getProfilePath())}`);\n      userDataDirIndex = chromeArguments.length - 1;\n    }\n    const userDataDir = chromeArguments[userDataDirIndex].split('=', 2)[1];\n    (0, assert_js_1.assert)(typeof userDataDir === 'string', '`--user-data-dir` is malformed');\n    let chromeExecutable = executablePath;\n    if (!chromeExecutable) {\n      (0, assert_js_1.assert)(channel || !this.puppeteer._isPuppeteerCore, `An \\`executablePath\\` or \\`channel\\` must be specified for \\`puppeteer-core\\``);\n      chromeExecutable = this.executablePath(channel);\n    }\n    return {\n      executablePath: chromeExecutable,\n      args: chromeArguments,\n      isTempUserDataDir,\n      userDataDir\n    };\n  }\n  /**\n   * @internal\n   */\n  async cleanUserDataDir(path, opts) {\n    if (opts.isTemp) {\n      try {\n        await (0, fs_js_1.rm)(path);\n      } catch (error) {\n        (0, util_js_1.debugError)(error);\n        throw error;\n      }\n    }\n  }\n  defaultArgs(options = {}) {\n    // See https://github.com/GoogleChrome/chrome-launcher/blob/main/docs/chrome-flags-for-tools.md\n    const chromeArguments = ['--allow-pre-commit-input', '--disable-background-networking', '--disable-background-timer-throttling', '--disable-backgrounding-occluded-windows', '--disable-breakpad', '--disable-client-side-phishing-detection', '--disable-component-extensions-with-background-pages', '--disable-component-update', '--disable-default-apps', '--disable-dev-shm-usage', '--disable-extensions',\n    // AcceptCHFrame disabled because of crbug.com/1348106.\n    '--disable-features=Translate,BackForwardCache,AcceptCHFrame,MediaRouter,OptimizationHints', '--disable-hang-monitor', '--disable-ipc-flooding-protection', '--disable-popup-blocking', '--disable-prompt-on-repost', '--disable-renderer-backgrounding', '--disable-sync', '--enable-automation',\n    // TODO(sadym): remove '--enable-blink-features=IdleDetection' once\n    // IdleDetection is turned on by default.\n    '--enable-blink-features=IdleDetection', '--enable-features=NetworkServiceInProcess2', '--export-tagged-pdf', '--force-color-profile=srgb', '--metrics-recording-only', '--no-first-run', '--password-store=basic', '--use-mock-keychain'];\n    const {\n      devtools = false,\n      headless = !devtools,\n      args = [],\n      userDataDir\n    } = options;\n    if (userDataDir) {\n      chromeArguments.push(`--user-data-dir=${path_1.default.resolve(userDataDir)}`);\n    }\n    if (devtools) {\n      chromeArguments.push('--auto-open-devtools-for-tabs');\n    }\n    if (headless) {\n      chromeArguments.push(headless === 'new' ? '--headless=new' : '--headless', '--hide-scrollbars', '--mute-audio');\n    }\n    if (args.every(arg => {\n      return arg.startsWith('-');\n    })) {\n      chromeArguments.push('about:blank');\n    }\n    chromeArguments.push(...args);\n    return chromeArguments;\n  }\n  executablePath(channel) {\n    if (channel) {\n      return (0, browsers_1.computeSystemExecutablePath)({\n        browser: browsers_1.Browser.CHROME,\n        channel: convertPuppeteerChannelToBrowsersChannel(channel)\n      });\n    } else {\n      return this.resolveExecutablePath();\n    }\n  }\n}\nexports.ChromeLauncher = ChromeLauncher;\nfunction convertPuppeteerChannelToBrowsersChannel(channel) {\n  switch (channel) {\n    case 'chrome':\n      return browsers_1.ChromeReleaseChannel.STABLE;\n    case 'chrome-dev':\n      return browsers_1.ChromeReleaseChannel.DEV;\n    case 'chrome-beta':\n      return browsers_1.ChromeReleaseChannel.BETA;\n    case 'chrome-canary':\n      return browsers_1.ChromeReleaseChannel.CANARY;\n  }\n}","map":{"version":3,"names":["promises_1","require","path_1","__importDefault","browsers_1","util_js_1","assert_js_1","ProductLauncher_js_1","fs_js_1","ChromeLauncher","ProductLauncher","constructor","puppeteer","launch","options","headless","_a","configuration","logLevel","Boolean","process","env","console","warn","join","computeLaunchArguments","ignoreDefaultArgs","args","pipe","debuggingPort","channel","executablePath","chromeArguments","push","defaultArgs","Array","isArray","filter","arg","includes","some","argument","startsWith","assert","isTempUserDataDir","userDataDirIndex","findIndex","mkdtemp","getProfilePath","length","userDataDir","split","chromeExecutable","_isPuppeteerCore","cleanUserDataDir","path","opts","isTemp","rm","error","debugError","devtools","default","resolve","every","computeSystemExecutablePath","browser","Browser","CHROME","convertPuppeteerChannelToBrowsersChannel","resolveExecutablePath","exports","ChromeReleaseChannel","STABLE","DEV","BETA","CANARY"],"sources":["../../../../src/node/ChromeLauncher.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAgBA,MAAAA,UAAA,GAAAC,OAAA;AACA,MAAAC,MAAA,GAAAC,eAAA,CAAAF,OAAA;AAEA,MAAAG,UAAA,GAAAH,OAAA;AAMA,MAAAI,SAAA,GAAAJ,OAAA;AAEA,MAAAK,WAAA,GAAAL,OAAA;AAOA,MAAAM,oBAAA,GAAAN,OAAA;AAEA,MAAAO,OAAA,GAAAP,OAAA;AAEA;;;AAGA,MAAaQ,cAAe,SAAQF,oBAAA,CAAAG,eAAe;EACjDC,YAAYC,SAAwB;IAClC,KAAK,CAACA,SAAS,EAAE,QAAQ,CAAC;EAC5B;EAESC,MAAMA,CAACC,OAAA,GAAsC,EAAE;;IACtD,MAAMC,QAAQ,GAAG,CAAAC,EAAA,GAAAF,OAAO,CAACC,QAAQ,cAAAC,EAAA,cAAAA,EAAA,GAAI,IAAI;IACzC,IACED,QAAQ,KAAK,IAAI,KAChB,CAAC,IAAI,CAACH,SAAS,CAACK,aAAa,CAACC,QAAQ,IACrC,IAAI,CAACN,SAAS,CAACK,aAAa,CAACC,QAAQ,KAAK,MAAM,CAAC,IACnD,CAACC,OAAO,CAACC,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAC,CAAC,EAC3D;MACAC,OAAO,CAACC,IAAI,CACV,CACE,yBAAyB,EACzB,4DAA4D,EAC5D,8EAA8E,EAC9E,mEAAmE,EACnE,gFAAgF,EAChF,iFAAiF,EACjF,uHAAuH,CACxH,CAACC,IAAI,CAAC,MAAM,CAAC,CACf;;IAGH,OAAO,KAAK,CAACX,MAAM,CAACC,OAAO,CAAC;EAC9B;EAEA;;;EAGS,MAAMW,sBAAsBA,CACnCX,OAAA,GAAsC,EAAE;IAExC,MAAM;MACJY,iBAAiB,GAAG,KAAK;MACzBC,IAAI,GAAG,EAAE;MACTC,IAAI,GAAG,KAAK;MACZC,aAAa;MACbC,OAAO;MACPC;IAAc,CACf,GAAGjB,OAAO;IAEX,MAAMkB,eAAe,GAAG,EAAE;IAC1B,IAAI,CAACN,iBAAiB,EAAE;MACtBM,eAAe,CAACC,IAAI,CAAC,GAAG,IAAI,CAACC,WAAW,CAACpB,OAAO,CAAC,CAAC;KACnD,MAAM,IAAIqB,KAAK,CAACC,OAAO,CAACV,iBAAiB,CAAC,EAAE;MAC3CM,eAAe,CAACC,IAAI,CAClB,GAAG,IAAI,CAACC,WAAW,CAACpB,OAAO,CAAC,CAACuB,MAAM,CAACC,GAAG,IAAG;QACxC,OAAO,CAACZ,iBAAiB,CAACa,QAAQ,CAACD,GAAG,CAAC;MACzC,CAAC,CAAC,CACH;KACF,MAAM;MACLN,eAAe,CAACC,IAAI,CAAC,GAAGN,IAAI,CAAC;;IAG/B,IACE,CAACK,eAAe,CAACQ,IAAI,CAACC,QAAQ,IAAG;MAC/B,OAAOA,QAAQ,CAACC,UAAU,CAAC,qBAAqB,CAAC;IACnD,CAAC,CAAC,EACF;MACA,IAAId,IAAI,EAAE;QACR,IAAAtB,WAAA,CAAAqC,MAAM,EACJ,CAACd,aAAa,EACd,2EAA2E,CAC5E;QACDG,eAAe,CAACC,IAAI,CAAC,yBAAyB,CAAC;OAChD,MAAM;QACLD,eAAe,CAACC,IAAI,CAAC,2BAA2BJ,aAAa,IAAI,CAAC,EAAE,CAAC;;;IAIzE,IAAIe,iBAAiB,GAAG,KAAK;IAE7B;IACA;IACA,IAAIC,gBAAgB,GAAGb,eAAe,CAACc,SAAS,CAACR,GAAG,IAAG;MACrD,OAAOA,GAAG,CAACI,UAAU,CAAC,iBAAiB,CAAC;IAC1C,CAAC,CAAC;IACF,IAAIG,gBAAgB,GAAG,CAAC,EAAE;MACxBD,iBAAiB,GAAG,IAAI;MACxBZ,eAAe,CAACC,IAAI,CAClB,mBAAmB,MAAM,IAAAjC,UAAA,CAAA+C,OAAO,EAAC,IAAI,CAACC,cAAc,EAAE,CAAC,EAAE,CAC1D;MACDH,gBAAgB,GAAGb,eAAe,CAACiB,MAAM,GAAG,CAAC;;IAG/C,MAAMC,WAAW,GAAGlB,eAAe,CAACa,gBAAgB,CAAE,CAACM,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;IACvE,IAAA7C,WAAA,CAAAqC,MAAM,EAAC,OAAOO,WAAW,KAAK,QAAQ,EAAE,gCAAgC,CAAC;IAEzE,IAAIE,gBAAgB,GAAGrB,cAAc;IACrC,IAAI,CAACqB,gBAAgB,EAAE;MACrB,IAAA9C,WAAA,CAAAqC,MAAM,EACJb,OAAO,IAAI,CAAC,IAAI,CAAClB,SAAS,CAACyC,gBAAgB,EAC3C,+EAA+E,CAChF;MACDD,gBAAgB,GAAG,IAAI,CAACrB,cAAc,CAACD,OAAO,CAAC;;IAGjD,OAAO;MACLC,cAAc,EAAEqB,gBAAgB;MAChCzB,IAAI,EAAEK,eAAe;MACrBY,iBAAiB;MACjBM;KACD;EACH;EAEA;;;EAGS,MAAMI,gBAAgBA,CAC7BC,IAAY,EACZC,IAAuB;IAEvB,IAAIA,IAAI,CAACC,MAAM,EAAE;MACf,IAAI;QACF,MAAM,IAAAjD,OAAA,CAAAkD,EAAE,EAACH,IAAI,CAAC;OACf,CAAC,OAAOI,KAAK,EAAE;QACd,IAAAtD,SAAA,CAAAuD,UAAU,EAACD,KAAK,CAAC;QACjB,MAAMA,KAAK;;;EAGjB;EAESzB,WAAWA,CAACpB,OAAA,GAAwC,EAAE;IAC7D;IACA,MAAMkB,eAAe,GAAG,CACtB,0BAA0B,EAC1B,iCAAiC,EACjC,uCAAuC,EACvC,0CAA0C,EAC1C,oBAAoB,EACpB,0CAA0C,EAC1C,sDAAsD,EACtD,4BAA4B,EAC5B,wBAAwB,EACxB,yBAAyB,EACzB,sBAAsB;IACtB;IACA,2FAA2F,EAC3F,wBAAwB,EACxB,mCAAmC,EACnC,0BAA0B,EAC1B,4BAA4B,EAC5B,kCAAkC,EAClC,gBAAgB,EAChB,qBAAqB;IACrB;IACA;IACA,uCAAuC,EACvC,4CAA4C,EAC5C,qBAAqB,EACrB,4BAA4B,EAC5B,0BAA0B,EAC1B,gBAAgB,EAChB,wBAAwB,EACxB,qBAAqB,CACtB;IACD,MAAM;MACJ6B,QAAQ,GAAG,KAAK;MAChB9C,QAAQ,GAAG,CAAC8C,QAAQ;MACpBlC,IAAI,GAAG,EAAE;MACTuB;IAAW,CACZ,GAAGpC,OAAO;IACX,IAAIoC,WAAW,EAAE;MACflB,eAAe,CAACC,IAAI,CAAC,mBAAmB/B,MAAA,CAAA4D,OAAI,CAACC,OAAO,CAACb,WAAW,CAAC,EAAE,CAAC;;IAEtE,IAAIW,QAAQ,EAAE;MACZ7B,eAAe,CAACC,IAAI,CAAC,+BAA+B,CAAC;;IAEvD,IAAIlB,QAAQ,EAAE;MACZiB,eAAe,CAACC,IAAI,CAClBlB,QAAQ,KAAK,KAAK,GAAG,gBAAgB,GAAG,YAAY,EACpD,mBAAmB,EACnB,cAAc,CACf;;IAEH,IACEY,IAAI,CAACqC,KAAK,CAAC1B,GAAG,IAAG;MACf,OAAOA,GAAG,CAACI,UAAU,CAAC,GAAG,CAAC;IAC5B,CAAC,CAAC,EACF;MACAV,eAAe,CAACC,IAAI,CAAC,aAAa,CAAC;;IAErCD,eAAe,CAACC,IAAI,CAAC,GAAGN,IAAI,CAAC;IAC7B,OAAOK,eAAe;EACxB;EAESD,cAAcA,CAACD,OAA8B;IACpD,IAAIA,OAAO,EAAE;MACX,OAAO,IAAA1B,UAAA,CAAA6D,2BAA2B,EAAC;QACjCC,OAAO,EAAE9D,UAAA,CAAA+D,OAAiB,CAACC,MAAM;QACjCtC,OAAO,EAAEuC,wCAAwC,CAACvC,OAAO;OAC1D,CAAC;KACH,MAAM;MACL,OAAO,IAAI,CAACwC,qBAAqB,EAAE;;EAEvC;;AAtMFC,OAAA,CAAA9D,cAAA,GAAAA,cAAA;AAyMA,SAAS4D,wCAAwCA,CAC/CvC,OAA6B;EAE7B,QAAQA,OAAO;IACb,KAAK,QAAQ;MACX,OAAO1B,UAAA,CAAAoE,oBAA4B,CAACC,MAAM;IAC5C,KAAK,YAAY;MACf,OAAOrE,UAAA,CAAAoE,oBAA4B,CAACE,GAAG;IACzC,KAAK,aAAa;MAChB,OAAOtE,UAAA,CAAAoE,oBAA4B,CAACG,IAAI;IAC1C,KAAK,eAAe;MAClB,OAAOvE,UAAA,CAAAoE,oBAA4B,CAACI,MAAM;;AAEhD"},"metadata":{},"sourceType":"script","externalDependencies":[]}