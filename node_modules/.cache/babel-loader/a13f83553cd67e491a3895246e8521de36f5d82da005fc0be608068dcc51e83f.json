{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RealmStorage = void 0;\nconst protocol_js_1 = require(\"../../../protocol/protocol.js\");\nclass RealmStorage {\n  /** Tracks handles and their realms sent to the client. */\n  #knownHandlesToRealm = new Map();\n  /** Map from realm ID to Realm. */\n  #realmMap = new Map();\n  get knownHandlesToRealm() {\n    return this.#knownHandlesToRealm;\n  }\n  get realmMap() {\n    return this.#realmMap;\n  }\n  findRealms(filter) {\n    return Array.from(this.#realmMap.values()).filter(realm => {\n      if (filter.realmId !== undefined && filter.realmId !== realm.realmId) {\n        return false;\n      }\n      if (filter.browsingContextId !== undefined && filter.browsingContextId !== realm.browsingContextId) {\n        return false;\n      }\n      if (filter.navigableId !== undefined && filter.navigableId !== realm.navigableId) {\n        return false;\n      }\n      if (filter.executionContextId !== undefined && filter.executionContextId !== realm.executionContextId) {\n        return false;\n      }\n      if (filter.origin !== undefined && filter.origin !== realm.origin) {\n        return false;\n      }\n      if (filter.type !== undefined && filter.type !== realm.type) {\n        return false;\n      }\n      if (filter.sandbox !== undefined && filter.sandbox !== realm.sandbox) {\n        return false;\n      }\n      if (filter.cdpSessionId !== undefined && filter.cdpSessionId !== realm.cdpSessionId) {\n        return false;\n      }\n      return true;\n    });\n  }\n  findRealm(filter) {\n    const maybeRealms = this.findRealms(filter);\n    if (maybeRealms.length !== 1) {\n      return undefined;\n    }\n    return maybeRealms[0];\n  }\n  getRealm(filter) {\n    const maybeRealm = this.findRealm(filter);\n    if (maybeRealm === undefined) {\n      throw new protocol_js_1.Message.NoSuchFrameException(`Realm ${JSON.stringify(filter)} not found`);\n    }\n    return maybeRealm;\n  }\n  deleteRealms(filter) {\n    this.findRealms(filter).map(realm => {\n      this.#realmMap.delete(realm.realmId);\n      Array.from(this.#knownHandlesToRealm.entries()).filter(([, r]) => r === realm.realmId).map(([h]) => this.#knownHandlesToRealm.delete(h));\n    });\n  }\n}\nexports.RealmStorage = RealmStorage;","map":{"version":3,"names":["protocol_js_1","require","RealmStorage","knownHandlesToRealm","Map","realmMap","findRealms","filter","Array","from","values","realm","realmId","undefined","browsingContextId","navigableId","executionContextId","origin","type","sandbox","cdpSessionId","findRealm","maybeRealms","length","getRealm","maybeRealm","Message","NoSuchFrameException","JSON","stringify","deleteRealms","map","delete","entries","r","h","exports"],"sources":["../../../../../src/bidiMapper/domains/script/realmStorage.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}