{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2020 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports._connectToCDPBrowser = void 0;\nconst environment_js_1 = require(\"../environment.js\");\nconst assert_js_1 = require(\"../util/assert.js\");\nconst ErrorLike_js_1 = require(\"../util/ErrorLike.js\");\nconst Browser_js_1 = require(\"./Browser.js\");\nconst Connection_js_1 = require(\"./Connection.js\");\nconst fetch_js_1 = require(\"./fetch.js\");\nconst util_js_1 = require(\"./util.js\");\nconst getWebSocketTransportClass = async () => {\n  return environment_js_1.isNode ? (await Promise.resolve().then(() => __importStar(require('./NodeWebSocketTransport.js')))).NodeWebSocketTransport : (await Promise.resolve().then(() => __importStar(require('./BrowserWebSocketTransport.js')))).BrowserWebSocketTransport;\n};\n/**\n * Users should never call this directly; it's called when calling\n * `puppeteer.connect`.\n *\n * @internal\n */\nasync function _connectToCDPBrowser(options) {\n  const {\n    browserWSEndpoint,\n    browserURL,\n    ignoreHTTPSErrors = false,\n    defaultViewport = {\n      width: 800,\n      height: 600\n    },\n    transport,\n    headers = {},\n    slowMo = 0,\n    targetFilter,\n    _isPageTarget: isPageTarget,\n    protocolTimeout\n  } = options;\n  (0, assert_js_1.assert)(Number(!!browserWSEndpoint) + Number(!!browserURL) + Number(!!transport) === 1, 'Exactly one of browserWSEndpoint, browserURL or transport must be passed to puppeteer.connect');\n  let connection;\n  if (transport) {\n    connection = new Connection_js_1.Connection('', transport, slowMo, protocolTimeout);\n  } else if (browserWSEndpoint) {\n    const WebSocketClass = await getWebSocketTransportClass();\n    const connectionTransport = await WebSocketClass.create(browserWSEndpoint, headers);\n    connection = new Connection_js_1.Connection(browserWSEndpoint, connectionTransport, slowMo, protocolTimeout);\n  } else if (browserURL) {\n    const connectionURL = await getWSEndpoint(browserURL);\n    const WebSocketClass = await getWebSocketTransportClass();\n    const connectionTransport = await WebSocketClass.create(connectionURL);\n    connection = new Connection_js_1.Connection(connectionURL, connectionTransport, slowMo, protocolTimeout);\n  }\n  const version = await connection.send('Browser.getVersion');\n  const product = version.product.toLowerCase().includes('firefox') ? 'firefox' : 'chrome';\n  const {\n    browserContextIds\n  } = await connection.send('Target.getBrowserContexts');\n  const browser = await Browser_js_1.CDPBrowser._create(product || 'chrome', connection, browserContextIds, ignoreHTTPSErrors, defaultViewport, undefined, () => {\n    return connection.send('Browser.close').catch(util_js_1.debugError);\n  }, targetFilter, isPageTarget);\n  return browser;\n}\nexports._connectToCDPBrowser = _connectToCDPBrowser;\nasync function getWSEndpoint(browserURL) {\n  const endpointURL = new URL('/json/version', browserURL);\n  const fetch = await (0, fetch_js_1.getFetch)();\n  try {\n    const result = await fetch(endpointURL.toString(), {\n      method: 'GET'\n    });\n    if (!result.ok) {\n      throw new Error(`HTTP ${result.statusText}`);\n    }\n    const data = await result.json();\n    return data.webSocketDebuggerUrl;\n  } catch (error) {\n    if ((0, ErrorLike_js_1.isErrorLike)(error)) {\n      error.message = `Failed to fetch browser webSocket URL from ${endpointURL}: ` + error.message;\n    }\n    throw error;\n  }\n}","map":{"version":3,"names":["environment_js_1","require","assert_js_1","ErrorLike_js_1","Browser_js_1","Connection_js_1","fetch_js_1","util_js_1","getWebSocketTransportClass","isNode","Promise","resolve","then","__importStar","NodeWebSocketTransport","BrowserWebSocketTransport","_connectToCDPBrowser","options","browserWSEndpoint","browserURL","ignoreHTTPSErrors","defaultViewport","width","height","transport","headers","slowMo","targetFilter","_isPageTarget","isPageTarget","protocolTimeout","assert","Number","connection","Connection","WebSocketClass","connectionTransport","create","connectionURL","getWSEndpoint","version","send","product","toLowerCase","includes","browserContextIds","browser","CDPBrowser","_create","undefined","catch","debugError","exports","endpointURL","URL","fetch","getFetch","result","toString","method","ok","Error","statusText","data","json","webSocketDebuggerUrl","error","isErrorLike","message"],"sources":["../../../../src/common/BrowserConnector.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiBA,MAAAA,gBAAA,GAAAC,OAAA;AACA,MAAAC,WAAA,GAAAD,OAAA;AACA,MAAAE,cAAA,GAAAF,OAAA;AAEA,MAAAG,YAAA,GAAAH,OAAA;AACA,MAAAI,eAAA,GAAAJ,OAAA;AAEA,MAAAK,UAAA,GAAAL,OAAA;AAGA,MAAAM,SAAA,GAAAN,OAAA;AA0CA,MAAMO,0BAA0B,GAAG,MAAAA,CAAA,KAAW;EAC5C,OAAOR,gBAAA,CAAAS,MAAM,GACT,CAAC,MAAAC,OAAA,CAAAC,OAAA,GAAAC,IAAA,OAAAC,YAAA,CAAAZ,OAAA,CAAa,6BAA6B,GAAC,EAAEa,sBAAsB,GACpE,CAAC,MAAAJ,OAAA,CAAAC,OAAA,GAAAC,IAAA,OAAAC,YAAA,CAAAZ,OAAA,CAAa,gCAAgC,GAAC,EAC5Cc,yBAAyB;AAClC,CAAC;AAED;;;;;;AAMO,eAAeC,oBAAoBA,CACxCC,OAA+C;EAE/C,MAAM;IACJC,iBAAiB;IACjBC,UAAU;IACVC,iBAAiB,GAAG,KAAK;IACzBC,eAAe,GAAG;MAACC,KAAK,EAAE,GAAG;MAAEC,MAAM,EAAE;IAAG,CAAC;IAC3CC,SAAS;IACTC,OAAO,GAAG,EAAE;IACZC,MAAM,GAAG,CAAC;IACVC,YAAY;IACZC,aAAa,EAAEC,YAAY;IAC3BC;EAAe,CAChB,GAAGb,OAAO;EAEX,IAAAf,WAAA,CAAA6B,MAAM,EACJC,MAAM,CAAC,CAAC,CAACd,iBAAiB,CAAC,GAAGc,MAAM,CAAC,CAAC,CAACb,UAAU,CAAC,GAAGa,MAAM,CAAC,CAAC,CAACR,SAAS,CAAC,KACtE,CAAC,EACH,+FAA+F,CAChG;EAED,IAAIS,UAAuB;EAC3B,IAAIT,SAAS,EAAE;IACbS,UAAU,GAAG,IAAI5B,eAAA,CAAA6B,UAAU,CAAC,EAAE,EAAEV,SAAS,EAAEE,MAAM,EAAEI,eAAe,CAAC;GACpE,MAAM,IAAIZ,iBAAiB,EAAE;IAC5B,MAAMiB,cAAc,GAAG,MAAM3B,0BAA0B,EAAE;IACzD,MAAM4B,mBAAmB,GACvB,MAAMD,cAAc,CAACE,MAAM,CAACnB,iBAAiB,EAAEO,OAAO,CAAC;IACzDQ,UAAU,GAAG,IAAI5B,eAAA,CAAA6B,UAAU,CACzBhB,iBAAiB,EACjBkB,mBAAmB,EACnBV,MAAM,EACNI,eAAe,CAChB;GACF,MAAM,IAAIX,UAAU,EAAE;IACrB,MAAMmB,aAAa,GAAG,MAAMC,aAAa,CAACpB,UAAU,CAAC;IACrD,MAAMgB,cAAc,GAAG,MAAM3B,0BAA0B,EAAE;IACzD,MAAM4B,mBAAmB,GACvB,MAAMD,cAAc,CAACE,MAAM,CAACC,aAAa,CAAC;IAC5CL,UAAU,GAAG,IAAI5B,eAAA,CAAA6B,UAAU,CACzBI,aAAa,EACbF,mBAAmB,EACnBV,MAAM,EACNI,eAAe,CAChB;;EAEH,MAAMU,OAAO,GAAG,MAAMP,UAAU,CAACQ,IAAI,CAAC,oBAAoB,CAAC;EAE3D,MAAMC,OAAO,GAAGF,OAAO,CAACE,OAAO,CAACC,WAAW,EAAE,CAACC,QAAQ,CAAC,SAAS,CAAC,GAC7D,SAAS,GACT,QAAQ;EAEZ,MAAM;IAACC;EAAiB,CAAC,GAAG,MAAMZ,UAAU,CAACQ,IAAI,CAC/C,2BAA2B,CAC5B;EACD,MAAMK,OAAO,GAAG,MAAM1C,YAAA,CAAA2C,UAAU,CAACC,OAAO,CACtCN,OAAO,IAAI,QAAQ,EACnBT,UAAU,EACVY,iBAAiB,EACjBzB,iBAAiB,EACjBC,eAAe,EACf4B,SAAS,EACT,MAAK;IACH,OAAOhB,UAAU,CAACQ,IAAI,CAAC,eAAe,CAAC,CAACS,KAAK,CAAC3C,SAAA,CAAA4C,UAAU,CAAC;EAC3D,CAAC,EACDxB,YAAY,EACZE,YAAY,CACb;EACD,OAAOiB,OAAO;AAChB;AAtEAM,OAAA,CAAApC,oBAAA,GAAAA,oBAAA;AAwEA,eAAeuB,aAAaA,CAACpB,UAAkB;EAC7C,MAAMkC,WAAW,GAAG,IAAIC,GAAG,CAAC,eAAe,EAAEnC,UAAU,CAAC;EAExD,MAAMoC,KAAK,GAAG,MAAM,IAAAjD,UAAA,CAAAkD,QAAQ,GAAE;EAC9B,IAAI;IACF,MAAMC,MAAM,GAAG,MAAMF,KAAK,CAACF,WAAW,CAACK,QAAQ,EAAE,EAAE;MACjDC,MAAM,EAAE;KACT,CAAC;IACF,IAAI,CAACF,MAAM,CAACG,EAAE,EAAE;MACd,MAAM,IAAIC,KAAK,CAAC,QAAQJ,MAAM,CAACK,UAAU,EAAE,CAAC;;IAE9C,MAAMC,IAAI,GAAG,MAAMN,MAAM,CAACO,IAAI,EAAE;IAChC,OAAOD,IAAI,CAACE,oBAAoB;GACjC,CAAC,OAAOC,KAAK,EAAE;IACd,IAAI,IAAA/D,cAAA,CAAAgE,WAAW,EAACD,KAAK,CAAC,EAAE;MACtBA,KAAK,CAACE,OAAO,GACX,8CAA8Cf,WAAW,IAAI,GAC7Da,KAAK,CAACE,OAAO;;IAEjB,MAAMF,KAAK;;AAEf"},"metadata":{},"sourceType":"script","externalDependencies":[]}