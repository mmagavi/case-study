{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2023 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.resolveBuildId = exports.relativeExecutablePath = exports.resolveDownloadPath = exports.resolveDownloadUrl = exports.resolveSystemExecutablePath = void 0;\nconst path_1 = __importDefault(require(\"path\"));\nconst httpUtil_js_1 = require(\"../httpUtil.js\");\nconst types_js_1 = require(\"./types.js\");\nvar chrome_js_1 = require(\"./chrome.js\");\nObject.defineProperty(exports, \"resolveSystemExecutablePath\", {\n  enumerable: true,\n  get: function () {\n    return chrome_js_1.resolveSystemExecutablePath;\n  }\n});\nfunction archive(platform, buildId) {\n  switch (platform) {\n    case types_js_1.BrowserPlatform.LINUX:\n      return 'chrome-linux';\n    case types_js_1.BrowserPlatform.MAC_ARM:\n    case types_js_1.BrowserPlatform.MAC:\n      return 'chrome-mac';\n    case types_js_1.BrowserPlatform.WIN32:\n    case types_js_1.BrowserPlatform.WIN64:\n      // Windows archive name changed at r591479.\n      return parseInt(buildId, 10) > 591479 ? 'chrome-win' : 'chrome-win32';\n  }\n}\nfunction folder(platform) {\n  switch (platform) {\n    case types_js_1.BrowserPlatform.LINUX:\n      return 'Linux_x64';\n    case types_js_1.BrowserPlatform.MAC_ARM:\n      return 'Mac_Arm';\n    case types_js_1.BrowserPlatform.MAC:\n      return 'Mac';\n    case types_js_1.BrowserPlatform.WIN32:\n      return 'Win';\n    case types_js_1.BrowserPlatform.WIN64:\n      return 'Win_x64';\n  }\n}\nfunction resolveDownloadUrl(platform, buildId, baseUrl = 'https://storage.googleapis.com/chromium-browser-snapshots') {\n  return `${baseUrl}/${resolveDownloadPath(platform, buildId).join('/')}`;\n}\nexports.resolveDownloadUrl = resolveDownloadUrl;\nfunction resolveDownloadPath(platform, buildId) {\n  return [folder(platform), buildId, `${archive(platform, buildId)}.zip`];\n}\nexports.resolveDownloadPath = resolveDownloadPath;\nfunction relativeExecutablePath(platform, _buildId) {\n  switch (platform) {\n    case types_js_1.BrowserPlatform.MAC:\n    case types_js_1.BrowserPlatform.MAC_ARM:\n      return path_1.default.join('chrome-mac', 'Chromium.app', 'Contents', 'MacOS', 'Chromium');\n    case types_js_1.BrowserPlatform.LINUX:\n      return path_1.default.join('chrome-linux', 'chrome');\n    case types_js_1.BrowserPlatform.WIN32:\n    case types_js_1.BrowserPlatform.WIN64:\n      return path_1.default.join('chrome-win', 'chrome.exe');\n  }\n}\nexports.relativeExecutablePath = relativeExecutablePath;\nasync function resolveBuildId(platform,\n// We will need it for other channels/keywords.\n_channel = 'latest') {\n  return new Promise((resolve, reject) => {\n    const request = (0, httpUtil_js_1.httpRequest)(new URL(`https://storage.googleapis.com/chromium-browser-snapshots/${folder(platform)}/LAST_CHANGE`), 'GET', response => {\n      let data = '';\n      if (response.statusCode && response.statusCode >= 400) {\n        return reject(new Error(`Got status code ${response.statusCode}`));\n      }\n      response.on('data', chunk => {\n        data += chunk;\n      });\n      response.on('end', () => {\n        try {\n          return resolve(String(data));\n        } catch {\n          return reject(new Error('Chrome version not found'));\n        }\n      });\n    }, false);\n    request.on('error', err => {\n      reject(err);\n    });\n  });\n}\nexports.resolveBuildId = resolveBuildId;","map":{"version":3,"names":["path_1","__importDefault","require","httpUtil_js_1","types_js_1","chrome_js_1","Object","defineProperty","exports","enumerable","get","resolveSystemExecutablePath","archive","platform","buildId","BrowserPlatform","LINUX","MAC_ARM","MAC","WIN32","WIN64","parseInt","folder","resolveDownloadUrl","baseUrl","resolveDownloadPath","join","relativeExecutablePath","_buildId","default","resolveBuildId","_channel","Promise","resolve","reject","request","httpRequest","URL","response","data","statusCode","Error","on","chunk","String","err"],"sources":["../../../src/browser-data/chromium.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}