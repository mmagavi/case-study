{"ast":null,"code":"import { Document } from \"../../document.js\";\nimport { BaseExampleSelector } from \"../base.js\";\nfunction sortedValues(values) {\n  return Object.keys(values).sort().map(key => values[key]);\n}\n/**\n * Class that selects examples based on semantic similarity. It extends\n * the BaseExampleSelector class.\n */\nexport class SemanticSimilarityExampleSelector extends BaseExampleSelector {\n  constructor(data) {\n    super(data);\n    Object.defineProperty(this, \"vectorStore\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"k\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: 4\n    });\n    Object.defineProperty(this, \"exampleKeys\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"inputKeys\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    this.vectorStore = data.vectorStore;\n    this.k = data.k ?? 4;\n    this.exampleKeys = data.exampleKeys;\n    this.inputKeys = data.inputKeys;\n  }\n  /**\n   * Method that adds a new example to the vectorStore. The example is\n   * converted to a string and added to the vectorStore as a document.\n   * @param example The example to be added to the vectorStore.\n   * @returns Promise that resolves when the example has been added to the vectorStore.\n   */\n  async addExample(example) {\n    const inputKeys = this.inputKeys ?? Object.keys(example);\n    const stringExample = sortedValues(inputKeys.reduce((acc, key) => ({\n      ...acc,\n      [key]: example[key]\n    }), {})).join(\" \");\n    await this.vectorStore.addDocuments([new Document({\n      pageContent: stringExample,\n      metadata: {\n        example\n      }\n    })]);\n  }\n  /**\n   * Method that selects which examples to use based on semantic similarity.\n   * It performs a similarity search in the vectorStore using the input\n   * variables and returns the examples with the highest similarity.\n   * @param inputVariables The input variables used for the similarity search.\n   * @returns Promise that resolves with an array of the selected examples.\n   */\n  async selectExamples(inputVariables) {\n    const inputKeys = this.inputKeys ?? Object.keys(inputVariables);\n    const query = sortedValues(inputKeys.reduce((acc, key) => ({\n      ...acc,\n      [key]: inputVariables[key]\n    }), {})).join(\" \");\n    const exampleDocs = await this.vectorStore.similaritySearch(query, this.k);\n    const examples = exampleDocs.map(doc => doc.metadata);\n    if (this.exampleKeys) {\n      // If example keys are provided, filter examples to those keys.\n      return examples.map(example => this.exampleKeys.reduce((acc, key) => ({\n        ...acc,\n        [key]: example[key]\n      }), {}));\n    }\n    return examples;\n  }\n  /**\n   * Static method that creates a new instance of\n   * SemanticSimilarityExampleSelector. It takes a list of examples, an\n   * instance of Embeddings, a VectorStore class, and an options object as\n   * parameters. It converts the examples to strings, creates a VectorStore\n   * from the strings and the embeddings, and returns a new\n   * SemanticSimilarityExampleSelector with the created VectorStore and the\n   * options provided.\n   * @param examples The list of examples to be used.\n   * @param embeddings The instance of Embeddings to be used.\n   * @param vectorStoreCls The VectorStore class to be used.\n   * @param options The options object for the SemanticSimilarityExampleSelector.\n   * @returns Promise that resolves with a new instance of SemanticSimilarityExampleSelector.\n   */\n  static async fromExamples(examples, embeddings, vectorStoreCls, options = {}) {\n    const inputKeys = options.inputKeys ?? null;\n    const stringExamples = examples.map(example => sortedValues(inputKeys ? inputKeys.reduce((acc, key) => ({\n      ...acc,\n      [key]: example[key]\n    }), {}) : example).join(\" \"));\n    const vectorStore = await vectorStoreCls.fromTexts(stringExamples, examples,\n    // metadatas\n    embeddings, options);\n    return new SemanticSimilarityExampleSelector({\n      vectorStore,\n      k: options.k ?? 4,\n      exampleKeys: options.exampleKeys,\n      inputKeys: options.inputKeys\n    });\n  }\n}","map":{"version":3,"names":["Document","BaseExampleSelector","sortedValues","values","Object","keys","sort","map","key","SemanticSimilarityExampleSelector","constructor","data","defineProperty","enumerable","configurable","writable","value","vectorStore","k","exampleKeys","inputKeys","addExample","example","stringExample","reduce","acc","join","addDocuments","pageContent","metadata","selectExamples","inputVariables","query","exampleDocs","similaritySearch","examples","doc","fromExamples","embeddings","vectorStoreCls","options","stringExamples","fromTexts"],"sources":["/Users/mayamagavi/instalily/case-study/node_modules/langchain/dist/prompts/selectors/SemanticSimilarityExampleSelector.js"],"sourcesContent":["import { Document } from \"../../document.js\";\nimport { BaseExampleSelector } from \"../base.js\";\nfunction sortedValues(values) {\n    return Object.keys(values)\n        .sort()\n        .map((key) => values[key]);\n}\n/**\n * Class that selects examples based on semantic similarity. It extends\n * the BaseExampleSelector class.\n */\nexport class SemanticSimilarityExampleSelector extends BaseExampleSelector {\n    constructor(data) {\n        super(data);\n        Object.defineProperty(this, \"vectorStore\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"k\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 4\n        });\n        Object.defineProperty(this, \"exampleKeys\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"inputKeys\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.vectorStore = data.vectorStore;\n        this.k = data.k ?? 4;\n        this.exampleKeys = data.exampleKeys;\n        this.inputKeys = data.inputKeys;\n    }\n    /**\n     * Method that adds a new example to the vectorStore. The example is\n     * converted to a string and added to the vectorStore as a document.\n     * @param example The example to be added to the vectorStore.\n     * @returns Promise that resolves when the example has been added to the vectorStore.\n     */\n    async addExample(example) {\n        const inputKeys = this.inputKeys ?? Object.keys(example);\n        const stringExample = sortedValues(inputKeys.reduce((acc, key) => ({ ...acc, [key]: example[key] }), {})).join(\" \");\n        await this.vectorStore.addDocuments([\n            new Document({\n                pageContent: stringExample,\n                metadata: { example },\n            }),\n        ]);\n    }\n    /**\n     * Method that selects which examples to use based on semantic similarity.\n     * It performs a similarity search in the vectorStore using the input\n     * variables and returns the examples with the highest similarity.\n     * @param inputVariables The input variables used for the similarity search.\n     * @returns Promise that resolves with an array of the selected examples.\n     */\n    async selectExamples(inputVariables) {\n        const inputKeys = this.inputKeys ?? Object.keys(inputVariables);\n        const query = sortedValues(inputKeys.reduce((acc, key) => ({ ...acc, [key]: inputVariables[key] }), {})).join(\" \");\n        const exampleDocs = await this.vectorStore.similaritySearch(query, this.k);\n        const examples = exampleDocs.map((doc) => doc.metadata);\n        if (this.exampleKeys) {\n            // If example keys are provided, filter examples to those keys.\n            return examples.map((example) => this.exampleKeys.reduce((acc, key) => ({ ...acc, [key]: example[key] }), {}));\n        }\n        return examples;\n    }\n    /**\n     * Static method that creates a new instance of\n     * SemanticSimilarityExampleSelector. It takes a list of examples, an\n     * instance of Embeddings, a VectorStore class, and an options object as\n     * parameters. It converts the examples to strings, creates a VectorStore\n     * from the strings and the embeddings, and returns a new\n     * SemanticSimilarityExampleSelector with the created VectorStore and the\n     * options provided.\n     * @param examples The list of examples to be used.\n     * @param embeddings The instance of Embeddings to be used.\n     * @param vectorStoreCls The VectorStore class to be used.\n     * @param options The options object for the SemanticSimilarityExampleSelector.\n     * @returns Promise that resolves with a new instance of SemanticSimilarityExampleSelector.\n     */\n    static async fromExamples(examples, embeddings, vectorStoreCls, options = {}) {\n        const inputKeys = options.inputKeys ?? null;\n        const stringExamples = examples.map((example) => sortedValues(inputKeys\n            ? inputKeys.reduce((acc, key) => ({ ...acc, [key]: example[key] }), {})\n            : example).join(\" \"));\n        const vectorStore = await vectorStoreCls.fromTexts(stringExamples, examples, // metadatas\n        embeddings, options);\n        return new SemanticSimilarityExampleSelector({\n            vectorStore,\n            k: options.k ?? 4,\n            exampleKeys: options.exampleKeys,\n            inputKeys: options.inputKeys,\n        });\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}