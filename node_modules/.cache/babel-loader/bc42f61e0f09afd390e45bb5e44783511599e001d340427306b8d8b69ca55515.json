{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2022 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar _FrameTree_frames, _FrameTree_parentIds, _FrameTree_childIds, _FrameTree_mainFrame, _FrameTree_waitRequests;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FrameTree = void 0;\nconst DeferredPromise_js_1 = require(\"../util/DeferredPromise.js\");\n/**\n * Keeps track of the page frame tree and it's is managed by\n * {@link FrameManager}. FrameTree uses frame IDs to reference frame and it\n * means that referenced frames might not be in the tree anymore. Thus, the tree\n * structure is eventually consistent.\n * @internal\n */\nclass FrameTree {\n  constructor() {\n    _FrameTree_frames.set(this, new Map());\n    // frameID -> parentFrameID\n    _FrameTree_parentIds.set(this, new Map());\n    // frameID -> childFrameIDs\n    _FrameTree_childIds.set(this, new Map());\n    _FrameTree_mainFrame.set(this, void 0);\n    _FrameTree_waitRequests.set(this, new Map());\n  }\n  getMainFrame() {\n    return __classPrivateFieldGet(this, _FrameTree_mainFrame, \"f\");\n  }\n  getById(frameId) {\n    return __classPrivateFieldGet(this, _FrameTree_frames, \"f\").get(frameId);\n  }\n  /**\n   * Returns a promise that is resolved once the frame with\n   * the given ID is added to the tree.\n   */\n  waitForFrame(frameId) {\n    const frame = this.getById(frameId);\n    if (frame) {\n      return Promise.resolve(frame);\n    }\n    const deferred = (0, DeferredPromise_js_1.createDeferredPromise)();\n    const callbacks = __classPrivateFieldGet(this, _FrameTree_waitRequests, \"f\").get(frameId) || new Set();\n    callbacks.add(deferred);\n    return deferred;\n  }\n  frames() {\n    return Array.from(__classPrivateFieldGet(this, _FrameTree_frames, \"f\").values());\n  }\n  addFrame(frame) {\n    var _a;\n    __classPrivateFieldGet(this, _FrameTree_frames, \"f\").set(frame._id, frame);\n    if (frame._parentId) {\n      __classPrivateFieldGet(this, _FrameTree_parentIds, \"f\").set(frame._id, frame._parentId);\n      if (!__classPrivateFieldGet(this, _FrameTree_childIds, \"f\").has(frame._parentId)) {\n        __classPrivateFieldGet(this, _FrameTree_childIds, \"f\").set(frame._parentId, new Set());\n      }\n      __classPrivateFieldGet(this, _FrameTree_childIds, \"f\").get(frame._parentId).add(frame._id);\n    } else {\n      __classPrivateFieldSet(this, _FrameTree_mainFrame, frame, \"f\");\n    }\n    (_a = __classPrivateFieldGet(this, _FrameTree_waitRequests, \"f\").get(frame._id)) === null || _a === void 0 ? void 0 : _a.forEach(request => {\n      return request.resolve(frame);\n    });\n  }\n  removeFrame(frame) {\n    var _a;\n    __classPrivateFieldGet(this, _FrameTree_frames, \"f\").delete(frame._id);\n    __classPrivateFieldGet(this, _FrameTree_parentIds, \"f\").delete(frame._id);\n    if (frame._parentId) {\n      (_a = __classPrivateFieldGet(this, _FrameTree_childIds, \"f\").get(frame._parentId)) === null || _a === void 0 ? void 0 : _a.delete(frame._id);\n    } else {\n      __classPrivateFieldSet(this, _FrameTree_mainFrame, undefined, \"f\");\n    }\n  }\n  childFrames(frameId) {\n    const childIds = __classPrivateFieldGet(this, _FrameTree_childIds, \"f\").get(frameId);\n    if (!childIds) {\n      return [];\n    }\n    return Array.from(childIds).map(id => {\n      return this.getById(id);\n    }).filter(frame => {\n      return frame !== undefined;\n    });\n  }\n  parentFrame(frameId) {\n    const parentId = __classPrivateFieldGet(this, _FrameTree_parentIds, \"f\").get(frameId);\n    return parentId ? this.getById(parentId) : undefined;\n  }\n}\nexports.FrameTree = FrameTree;\n_FrameTree_frames = new WeakMap(), _FrameTree_parentIds = new WeakMap(), _FrameTree_childIds = new WeakMap(), _FrameTree_mainFrame = new WeakMap(), _FrameTree_waitRequests = new WeakMap();","map":{"version":3,"names":["DeferredPromise_js_1","require","FrameTree","constructor","_FrameTree_frames","set","Map","_FrameTree_parentIds","_FrameTree_childIds","_FrameTree_mainFrame","_FrameTree_waitRequests","getMainFrame","__classPrivateFieldGet","getById","frameId","get","waitForFrame","frame","Promise","resolve","deferred","createDeferredPromise","callbacks","Set","add","frames","Array","from","values","addFrame","_id","_parentId","has","__classPrivateFieldSet","_a","forEach","request","removeFrame","delete","undefined","childFrames","childIds","map","id","filter","parentFrame","parentId","exports"],"sources":["../../../../src/common/FrameTree.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}