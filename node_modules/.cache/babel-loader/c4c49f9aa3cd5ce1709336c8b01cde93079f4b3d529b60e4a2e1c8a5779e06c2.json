{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2023 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _JSHandle_disposed, _JSHandle_context, _JSHandle_remoteValue;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.JSHandle = void 0;\nconst JSHandle_js_1 = require(\"../../api/JSHandle.js\");\nconst Serializer_js_1 = require(\"./Serializer.js\");\nconst utils_js_1 = require(\"./utils.js\");\nclass JSHandle extends JSHandle_js_1.JSHandle {\n  constructor(context, remoteValue) {\n    super();\n    _JSHandle_disposed.set(this, false);\n    _JSHandle_context.set(this, void 0);\n    _JSHandle_remoteValue.set(this, void 0);\n    __classPrivateFieldSet(this, _JSHandle_context, context, \"f\");\n    __classPrivateFieldSet(this, _JSHandle_remoteValue, remoteValue, \"f\");\n  }\n  context() {\n    return __classPrivateFieldGet(this, _JSHandle_context, \"f\");\n  }\n  get connection() {\n    return __classPrivateFieldGet(this, _JSHandle_context, \"f\").connection;\n  }\n  get disposed() {\n    return __classPrivateFieldGet(this, _JSHandle_disposed, \"f\");\n  }\n  async evaluate(pageFunction, ...args) {\n    return await this.context().evaluate(pageFunction, this, ...args);\n  }\n  async evaluateHandle(pageFunction, ...args) {\n    return await this.context().evaluateHandle(pageFunction, this, ...args);\n  }\n  async getProperty(propertyName) {\n    return await this.evaluateHandle((object, propertyName) => {\n      return object[propertyName];\n    }, propertyName);\n  }\n  async getProperties() {\n    // TODO(lightning00blade): Either include return of depth Handles in RemoteValue\n    // or new BiDi command that returns array of remote value\n    const keys = await this.evaluate(object => {\n      return Object.getOwnPropertyNames(object);\n    });\n    const map = new Map();\n    const results = await Promise.all(keys.map(key => {\n      return this.getProperty(key);\n    }));\n    for (const [key, value] of Object.entries(keys)) {\n      const handle = results[key];\n      if (handle) {\n        map.set(value, handle);\n      }\n    }\n    return map;\n  }\n  async jsonValue() {\n    const value = Serializer_js_1.BidiSerializer.deserialize(__classPrivateFieldGet(this, _JSHandle_remoteValue, \"f\"));\n    if (__classPrivateFieldGet(this, _JSHandle_remoteValue, \"f\").type !== 'undefined' && value === undefined) {\n      throw new Error('Could not serialize referenced object');\n    }\n    return value;\n  }\n  asElement() {\n    return null;\n  }\n  async dispose() {\n    if (__classPrivateFieldGet(this, _JSHandle_disposed, \"f\")) {\n      return;\n    }\n    __classPrivateFieldSet(this, _JSHandle_disposed, true, \"f\");\n    if ('handle' in __classPrivateFieldGet(this, _JSHandle_remoteValue, \"f\")) {\n      await (0, utils_js_1.releaseReference)(__classPrivateFieldGet(this, _JSHandle_context, \"f\"), __classPrivateFieldGet(this, _JSHandle_remoteValue, \"f\"));\n    }\n  }\n  get isPrimitiveValue() {\n    switch (__classPrivateFieldGet(this, _JSHandle_remoteValue, \"f\").type) {\n      case 'string':\n      case 'number':\n      case 'bigint':\n      case 'boolean':\n      case 'undefined':\n      case 'null':\n        return true;\n      default:\n        return false;\n    }\n  }\n  toString() {\n    if (this.isPrimitiveValue) {\n      return 'JSHandle:' + Serializer_js_1.BidiSerializer.deserialize(__classPrivateFieldGet(this, _JSHandle_remoteValue, \"f\"));\n    }\n    return 'JSHandle@' + __classPrivateFieldGet(this, _JSHandle_remoteValue, \"f\").type;\n  }\n  get id() {\n    return 'handle' in __classPrivateFieldGet(this, _JSHandle_remoteValue, \"f\") ? __classPrivateFieldGet(this, _JSHandle_remoteValue, \"f\").handle : undefined;\n  }\n  remoteValue() {\n    return __classPrivateFieldGet(this, _JSHandle_remoteValue, \"f\");\n  }\n}\nexports.JSHandle = JSHandle;\n_JSHandle_disposed = new WeakMap(), _JSHandle_context = new WeakMap(), _JSHandle_remoteValue = new WeakMap();","map":{"version":3,"names":["JSHandle_js_1","require","Serializer_js_1","utils_js_1","JSHandle","constructor","context","remoteValue","_JSHandle_disposed","set","_JSHandle_context","_JSHandle_remoteValue","__classPrivateFieldSet","__classPrivateFieldGet","connection","disposed","evaluate","pageFunction","args","evaluateHandle","getProperty","propertyName","object","getProperties","keys","Object","getOwnPropertyNames","map","Map","results","Promise","all","key","value","entries","handle","jsonValue","BidiSerializer","deserialize","type","undefined","Error","asElement","dispose","releaseReference","isPrimitiveValue","toString","id","exports"],"sources":["../../../../../src/common/bidi/JSHandle.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}