{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.BrowsingContextProcessor = void 0;\nconst protocol_js_1 = require(\"../../../protocol/protocol.js\");\nconst log_js_1 = require(\"../../../utils/log.js\");\nconst browsingContextImpl_js_1 = require(\"./browsingContextImpl.js\");\nconst cdpTarget_js_1 = require(\"./cdpTarget.js\");\nclass BrowsingContextProcessor {\n  #browsingContextStorage;\n  #cdpConnection;\n  #eventManager;\n  #logger;\n  #realmStorage;\n  #selfTargetId;\n  constructor(realmStorage, cdpConnection, selfTargetId, eventManager, browsingContextStorage, logger) {\n    this.#browsingContextStorage = browsingContextStorage;\n    this.#cdpConnection = cdpConnection;\n    this.#eventManager = eventManager;\n    this.#logger = logger;\n    this.#realmStorage = realmStorage;\n    this.#selfTargetId = selfTargetId;\n    this.#setEventListeners(this.#cdpConnection.browserClient());\n  }\n  /**\n   * This method is called for each CDP session, since this class is responsible\n   * for creating and destroying all targets and browsing contexts.\n   */\n  #setEventListeners(cdpClient) {\n    cdpClient.on('Target.attachedToTarget', params => {\n      this.#handleAttachedToTargetEvent(params, cdpClient);\n    });\n    cdpClient.on('Target.detachedFromTarget', params => {\n      this.#handleDetachedFromTargetEvent(params);\n    });\n    cdpClient.on('Page.frameAttached', params => {\n      this.#handleFrameAttachedEvent(params);\n    });\n    cdpClient.on('Page.frameDetached', params => {\n      this.#handleFrameDetachedEvent(params);\n    });\n  }\n  // { \"method\": \"Page.frameAttached\",\n  //   \"params\": {\n  //     \"frameId\": \"0A639AB1D9A392DF2CE02C53CC4ED3A6\",\n  //     \"parentFrameId\": \"722BB0526C73B067A479BED6D0DB1156\" } }\n  #handleFrameAttachedEvent(params) {\n    const parentBrowsingContext = this.#browsingContextStorage.findContext(params.parentFrameId);\n    if (parentBrowsingContext !== undefined) {\n      browsingContextImpl_js_1.BrowsingContextImpl.create(parentBrowsingContext.cdpTarget, this.#realmStorage, params.frameId, params.parentFrameId, this.#eventManager, this.#browsingContextStorage, this.#logger);\n    }\n  }\n  // { \"method\": \"Page.frameDetached\",\n  //   \"params\": {\n  //     \"frameId\": \"0A639AB1D9A392DF2CE02C53CC4ED3A6\",\n  //     \"reason\": \"swap\" } }\n  #handleFrameDetachedEvent(params) {\n    // In case of OOPiF no need in deleting BrowsingContext.\n    if (params.reason === 'swap') {\n      return;\n    }\n    this.#browsingContextStorage.findContext(params.frameId)?.delete();\n  }\n  // { \"method\": \"Target.attachedToTarget\",\n  //   \"params\": {\n  //     \"sessionId\": \"EA999F39BDCABD7D45C9FEB787413BBA\",\n  //     \"targetInfo\": {\n  //       \"targetId\": \"722BB0526C73B067A479BED6D0DB1156\",\n  //       \"type\": \"page\",\n  //       \"title\": \"about:blank\",\n  //       \"url\": \"about:blank\",\n  //       \"attached\": true,\n  //       \"canAccessOpener\": false,\n  //       \"browserContextId\": \"1B5244080EC3FF28D03BBDA73138C0E2\" },\n  //     \"waitingForDebugger\": false } }\n  #handleAttachedToTargetEvent(params, parentSessionCdpClient) {\n    const {\n      sessionId,\n      targetInfo\n    } = params;\n    const targetCdpClient = this.#cdpConnection.getCdpClient(sessionId);\n    if (!this.#isValidTarget(targetInfo)) {\n      // DevTools or some other not supported by BiDi target. Just release\n      // debugger  and ignore them.\n      void targetCdpClient.sendCommand('Runtime.runIfWaitingForDebugger').then(() => parentSessionCdpClient.sendCommand('Target.detachFromTarget', params));\n      return;\n    }\n    this.#logger?.(log_js_1.LogType.browsingContexts, 'AttachedToTarget event received:', JSON.stringify(params, null, 2));\n    this.#setEventListeners(targetCdpClient);\n    const cdpTarget = cdpTarget_js_1.CdpTarget.create(targetInfo.targetId, targetCdpClient, sessionId, this.#realmStorage, this.#eventManager);\n    if (this.#browsingContextStorage.hasContext(targetInfo.targetId)) {\n      // OOPiF.\n      this.#browsingContextStorage.getContext(targetInfo.targetId).updateCdpTarget(cdpTarget);\n    } else {\n      browsingContextImpl_js_1.BrowsingContextImpl.create(cdpTarget, this.#realmStorage, targetInfo.targetId, null, this.#eventManager, this.#browsingContextStorage, this.#logger);\n    }\n  }\n  // { \"method\": \"Target.detachedFromTarget\",\n  //   \"params\": {\n  //     \"sessionId\": \"7EFBFB2A4942A8989B3EADC561BC46E9\",\n  //     \"targetId\": \"19416886405CBA4E03DBB59FA67FF4E8\" } }\n  #handleDetachedFromTargetEvent(params) {\n    // TODO: params.targetId is deprecated. Update this class to track using\n    // params.sessionId instead.\n    // https://github.com/GoogleChromeLabs/chromium-bidi/issues/60\n    const contextId = params.targetId;\n    this.#browsingContextStorage.findContext(contextId)?.delete();\n  }\n  async #getRealm(target) {\n    if ('realm' in target) {\n      return this.#realmStorage.getRealm({\n        realmId: target.realm\n      });\n    }\n    const context = this.#browsingContextStorage.getContext(target.context);\n    return context.getOrCreateSandbox(target.sandbox);\n  }\n  process_browsingContext_getTree(params) {\n    const resultContexts = params.root === undefined ? this.#browsingContextStorage.getTopLevelContexts() : [this.#browsingContextStorage.getContext(params.root)];\n    return {\n      result: {\n        contexts: resultContexts.map(c => c.serializeToBidiValue(params.maxDepth ?? Number.MAX_VALUE))\n      }\n    };\n  }\n  async process_browsingContext_create(params) {\n    const browserCdpClient = this.#cdpConnection.browserClient();\n    let referenceContext = undefined;\n    if (params.referenceContext !== undefined) {\n      referenceContext = this.#browsingContextStorage.getContext(params.referenceContext);\n      if (!referenceContext.isTopLevelContext()) {\n        throw new protocol_js_1.Message.InvalidArgumentException(`referenceContext should be a top-level context`);\n      }\n    }\n    const result = await browserCdpClient.sendCommand('Target.createTarget', {\n      url: 'about:blank',\n      newWindow: params.type === 'window'\n    });\n    // Wait for the new tab to be loaded to avoid race conditions in the\n    // `browsingContext` events, when the `browsingContext.domContentLoaded` and\n    // `browsingContext.load` events from the initial `about:blank` navigation\n    // are emitted after the next navigation is started.\n    // Details: https://github.com/web-platform-tests/wpt/issues/35846\n    const contextId = result.targetId;\n    const context = this.#browsingContextStorage.getContext(contextId);\n    await context.awaitLoaded();\n    return {\n      result: context.serializeToBidiValue(1)\n    };\n  }\n  process_browsingContext_navigate(params) {\n    const context = this.#browsingContextStorage.getContext(params.context);\n    return context.navigate(params.url, params.wait === undefined ? 'none' : params.wait);\n  }\n  async process_browsingContext_captureScreenshot(params) {\n    const context = this.#browsingContextStorage.getContext(params.context);\n    return context.captureScreenshot();\n  }\n  async process_browsingContext_print(params) {\n    const context = this.#browsingContextStorage.getContext(params.context);\n    return context.print(params);\n  }\n  async process_script_addPreloadScript(params) {\n    const contexts = [];\n    const scripts = [];\n    if (params.context) {\n      // TODO(#293): Handle edge case with OOPiF. Whenever a frame is moved out\n      // of process, we have to add those scripts as well.\n      contexts.push(this.#browsingContextStorage.getContext(params.context));\n    } else {\n      // Add all contexts.\n      // TODO(#293): Add preload scripts to all new browsing contexts as well.\n      contexts.push(...this.#browsingContextStorage.getAllContexts());\n    }\n    scripts.push(...(await Promise.all(contexts.map(context => context.addPreloadScript(params)))));\n    // TODO(#293): What to return whenever there are multiple contexts?\n    return scripts[0];\n  }\n  // eslint-disable-next-line @typescript-eslint/require-await\n  async process_script_removePreloadScript(_params) {\n    throw new protocol_js_1.Message.UnknownErrorException('Not implemented.');\n    return {};\n  }\n  async process_script_evaluate(params) {\n    const realm = await this.#getRealm(params.target);\n    return realm.scriptEvaluate(params.expression, params.awaitPromise, params.resultOwnership ?? 'none');\n  }\n  process_script_getRealms(params) {\n    if (params.context !== undefined) {\n      // Make sure the context is known.\n      this.#browsingContextStorage.getContext(params.context);\n    }\n    const realms = this.#realmStorage.findRealms({\n      browsingContextId: params.context,\n      type: params.type\n    }).map(realm => realm.toBiDi());\n    return {\n      result: {\n        realms\n      }\n    };\n  }\n  async process_script_callFunction(params) {\n    const realm = await this.#getRealm(params.target);\n    return realm.callFunction(params.functionDeclaration, params.this || {\n      type: 'undefined'\n    },\n    // `this` is `undefined` by default.\n    params.arguments || [],\n    // `arguments` is `[]` by default.\n    params.awaitPromise, params.resultOwnership ?? 'none');\n  }\n  async process_script_disown(params) {\n    const realm = await this.#getRealm(params.target);\n    await Promise.all(params.handles.map(async h => realm.disown(h)));\n    return {\n      result: {}\n    };\n  }\n  async process_browsingContext_close(commandParams) {\n    const browserCdpClient = this.#cdpConnection.browserClient();\n    const context = this.#browsingContextStorage.getContext(commandParams.context);\n    if (!context.isTopLevelContext()) {\n      throw new protocol_js_1.Message.InvalidArgumentException('A top-level browsing context cannot be closed.');\n    }\n    const detachedFromTargetPromise = new Promise(resolve => {\n      const onContextDestroyed = eventParams => {\n        if (eventParams.targetId === commandParams.context) {\n          browserCdpClient.off('Target.detachedFromTarget', onContextDestroyed);\n          resolve();\n        }\n      };\n      browserCdpClient.on('Target.detachedFromTarget', onContextDestroyed);\n    });\n    await browserCdpClient.sendCommand('Target.closeTarget', {\n      targetId: commandParams.context\n    });\n    // Sometimes CDP command finishes before `detachedFromTarget` event,\n    // sometimes after. Wait for the CDP command to be finished, and then wait\n    // for `detachedFromTarget` if it hasn't emitted.\n    await detachedFromTargetPromise;\n    return {\n      result: {}\n    };\n  }\n  #isValidTarget(target) {\n    if (target.targetId === this.#selfTargetId) {\n      return false;\n    }\n    return ['page', 'iframe'].includes(target.type);\n  }\n  async process_cdp_sendCommand(params) {\n    const client = params.cdpSession ? this.#cdpConnection.getCdpClient(params.cdpSession) : this.#cdpConnection.browserClient();\n    const sendCdpCommandResult = await client.sendCommand(params.cdpMethod, params.cdpParams);\n    return {\n      result: sendCdpCommandResult,\n      cdpSession: params.cdpSession\n    };\n  }\n  process_cdp_getSession(params) {\n    const context = params.context;\n    const sessionId = this.#browsingContextStorage.getContext(context).cdpTarget.cdpSessionId;\n    if (sessionId === undefined) {\n      return {\n        result: {\n          cdpSession: null\n        }\n      };\n    }\n    return {\n      result: {\n        cdpSession: sessionId\n      }\n    };\n  }\n}\nexports.BrowsingContextProcessor = BrowsingContextProcessor;","map":{"version":3,"names":["protocol_js_1","require","log_js_1","browsingContextImpl_js_1","cdpTarget_js_1","BrowsingContextProcessor","browsingContextStorage","cdpConnection","eventManager","logger","realmStorage","selfTargetId","constructor","setEventListeners","browserClient","#setEventListeners","cdpClient","on","params","handleAttachedToTargetEvent","handleDetachedFromTargetEvent","handleFrameAttachedEvent","handleFrameDetachedEvent","#handleFrameAttachedEvent","parentBrowsingContext","findContext","parentFrameId","undefined","BrowsingContextImpl","create","cdpTarget","frameId","#handleFrameDetachedEvent","reason","delete","#handleAttachedToTargetEvent","parentSessionCdpClient","sessionId","targetInfo","targetCdpClient","getCdpClient","isValidTarget","sendCommand","then","LogType","browsingContexts","JSON","stringify","CdpTarget","targetId","hasContext","getContext","updateCdpTarget","#handleDetachedFromTargetEvent","contextId","getRealm","#getRealm","target","realmId","realm","context","getOrCreateSandbox","sandbox","process_browsingContext_getTree","resultContexts","root","getTopLevelContexts","result","contexts","map","c","serializeToBidiValue","maxDepth","Number","MAX_VALUE","process_browsingContext_create","browserCdpClient","referenceContext","isTopLevelContext","Message","InvalidArgumentException","url","newWindow","type","awaitLoaded","process_browsingContext_navigate","navigate","wait","process_browsingContext_captureScreenshot","captureScreenshot","process_browsingContext_print","print","process_script_addPreloadScript","scripts","push","getAllContexts","Promise","all","addPreloadScript","process_script_removePreloadScript","_params","UnknownErrorException","process_script_evaluate","scriptEvaluate","expression","awaitPromise","resultOwnership","process_script_getRealms","realms","findRealms","browsingContextId","toBiDi","process_script_callFunction","callFunction","functionDeclaration","this","arguments","process_script_disown","handles","h","disown","process_browsingContext_close","commandParams","detachedFromTargetPromise","resolve","onContextDestroyed","eventParams","off","#isValidTarget","includes","process_cdp_sendCommand","client","cdpSession","sendCdpCommandResult","cdpMethod","cdpParams","process_cdp_getSession","cdpSessionId","exports"],"sources":["../../../../../src/bidiMapper/domains/context/browsingContextProcessor.ts"],"sourcesContent":[null],"mappings":";;;;;;AAkBA,MAAAA,aAAA,GAAAC,OAAA;AAOA,MAAAC,QAAA,GAAAD,OAAA;AAMA,MAAAE,wBAAA,GAAAF,OAAA;AACA,MAAAG,cAAA,GAAAH,OAAA;AAEA,MAAaI,wBAAwB;EAC1B,CAAAC,sBAAuB;EACvB,CAAAC,aAAc;EACd,CAAAC,YAAa;EACb,CAAAC,MAAO;EACP,CAAAC,YAAa;EACb,CAAAC,YAAa;EAEtBC,YACEF,YAA0B,EAC1BH,aAA4B,EAC5BI,YAAoB,EACpBH,YAA2B,EAC3BF,sBAA8C,EAC9CG,MAAiB;IAEjB,IAAI,CAAC,CAAAH,sBAAuB,GAAGA,sBAAsB;IACrD,IAAI,CAAC,CAAAC,aAAc,GAAGA,aAAa;IACnC,IAAI,CAAC,CAAAC,YAAa,GAAGA,YAAY;IACjC,IAAI,CAAC,CAAAC,MAAO,GAAGA,MAAM;IACrB,IAAI,CAAC,CAAAC,YAAa,GAAGA,YAAY;IACjC,IAAI,CAAC,CAAAC,YAAa,GAAGA,YAAY;IAEjC,IAAI,CAAC,CAAAE,iBAAkB,CAAC,IAAI,CAAC,CAAAN,aAAc,CAACO,aAAa,EAAE,CAAC;EAC9D;EAEA;;;;EAIA,CAAAD,iBAAkBE,CAACC,SAAoB;IACrCA,SAAS,CAACC,EAAE,CAAC,yBAAyB,EAAGC,MAAM,IAAI;MACjD,IAAI,CAAC,CAAAC,2BAA4B,CAACD,MAAM,EAAEF,SAAS,CAAC;IACtD,CAAC,CAAC;IACFA,SAAS,CAACC,EAAE,CAAC,2BAA2B,EAAGC,MAAM,IAAI;MACnD,IAAI,CAAC,CAAAE,6BAA8B,CAACF,MAAM,CAAC;IAC7C,CAAC,CAAC;IAEFF,SAAS,CAACC,EAAE,CACV,oBAAoB,EACnBC,MAAwC,IAAI;MAC3C,IAAI,CAAC,CAAAG,wBAAyB,CAACH,MAAM,CAAC;IACxC,CAAC,CACF;IACDF,SAAS,CAACC,EAAE,CACV,oBAAoB,EACnBC,MAAwC,IAAI;MAC3C,IAAI,CAAC,CAAAI,wBAAyB,CAACJ,MAAM,CAAC;IACxC,CAAC,CACF;EACH;EAEA;EACA;EACA;EACA;EACA,CAAAG,wBAAyBE,CAACL,MAAwC;IAChE,MAAMM,qBAAqB,GAAG,IAAI,CAAC,CAAAlB,sBAAuB,CAACmB,WAAW,CACpEP,MAAM,CAACQ,aAAa,CACrB;IACD,IAAIF,qBAAqB,KAAKG,SAAS,EAAE;MACvCxB,wBAAA,CAAAyB,mBAAmB,CAACC,MAAM,CACxBL,qBAAqB,CAACM,SAAS,EAC/B,IAAI,CAAC,CAAApB,YAAa,EAClBQ,MAAM,CAACa,OAAO,EACdb,MAAM,CAACQ,aAAa,EACpB,IAAI,CAAC,CAAAlB,YAAa,EAClB,IAAI,CAAC,CAAAF,sBAAuB,EAC5B,IAAI,CAAC,CAAAG,MAAO,CACb;;EAEL;EAEA;EACA;EACA;EACA;EACA,CAAAa,wBAAyBU,CAACd,MAAwC;IAChE;IACA,IAAIA,MAAM,CAACe,MAAM,KAAK,MAAM,EAAE;MAC5B;;IAEF,IAAI,CAAC,CAAA3B,sBAAuB,CAACmB,WAAW,CAACP,MAAM,CAACa,OAAO,CAAC,EAAEG,MAAM,EAAE;EACpE;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,CAAAf,2BAA4BgB,CAC1BjB,MAA6C,EAC7CkB,sBAAiC;IAEjC,MAAM;MAACC,SAAS;MAAEC;IAAU,CAAC,GAAGpB,MAAM;IAEtC,MAAMqB,eAAe,GAAG,IAAI,CAAC,CAAAhC,aAAc,CAACiC,YAAY,CAACH,SAAS,CAAC;IAEnE,IAAI,CAAC,IAAI,CAAC,CAAAI,aAAc,CAACH,UAAU,CAAC,EAAE;MACpC;MACA;MACA,KAAKC,eAAe,CACjBG,WAAW,CAAC,iCAAiC,CAAC,CAC9CC,IAAI,CAAC,MACJP,sBAAsB,CAACM,WAAW,CAAC,yBAAyB,EAAExB,MAAM,CAAC,CACtE;MACH;;IAGF,IAAI,CAAC,CAAAT,MAAO,GACVP,QAAA,CAAA0C,OAAO,CAACC,gBAAgB,EACxB,kCAAkC,EAClCC,IAAI,CAACC,SAAS,CAAC7B,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC,CAChC;IAED,IAAI,CAAC,CAAAL,iBAAkB,CAAC0B,eAAe,CAAC;IAExC,MAAMT,SAAS,GAAG1B,cAAA,CAAA4C,SAAS,CAACnB,MAAM,CAChCS,UAAU,CAACW,QAAQ,EACnBV,eAAe,EACfF,SAAS,EACT,IAAI,CAAC,CAAA3B,YAAa,EAClB,IAAI,CAAC,CAAAF,YAAa,CACnB;IAED,IAAI,IAAI,CAAC,CAAAF,sBAAuB,CAAC4C,UAAU,CAACZ,UAAU,CAACW,QAAQ,CAAC,EAAE;MAChE;MACA,IAAI,CAAC,CAAA3C,sBAAuB,CACzB6C,UAAU,CAACb,UAAU,CAACW,QAAQ,CAAC,CAC/BG,eAAe,CAACtB,SAAS,CAAC;KAC9B,MAAM;MACL3B,wBAAA,CAAAyB,mBAAmB,CAACC,MAAM,CACxBC,SAAS,EACT,IAAI,CAAC,CAAApB,YAAa,EAClB4B,UAAU,CAACW,QAAQ,EACnB,IAAI,EACJ,IAAI,CAAC,CAAAzC,YAAa,EAClB,IAAI,CAAC,CAAAF,sBAAuB,EAC5B,IAAI,CAAC,CAAAG,MAAO,CACb;;EAEL;EAEA;EACA;EACA;EACA;EACA,CAAAW,6BAA8BiC,CAC5BnC,MAA+C;IAE/C;IACA;IACA;IACA,MAAMoC,SAAS,GAAGpC,MAAM,CAAC+B,QAAS;IAClC,IAAI,CAAC,CAAA3C,sBAAuB,CAACmB,WAAW,CAAC6B,SAAS,CAAC,EAAEpB,MAAM,EAAE;EAC/D;EAEA,MAAM,CAAAqB,QAASC,CAACC,MAAqB;IACnC,IAAI,OAAO,IAAIA,MAAM,EAAE;MACrB,OAAO,IAAI,CAAC,CAAA/C,YAAa,CAAC6C,QAAQ,CAAC;QACjCG,OAAO,EAAED,MAAM,CAACE;OACjB,CAAC;;IAEJ,MAAMC,OAAO,GAAG,IAAI,CAAC,CAAAtD,sBAAuB,CAAC6C,UAAU,CAACM,MAAM,CAACG,OAAO,CAAC;IACvE,OAAOA,OAAO,CAACC,kBAAkB,CAACJ,MAAM,CAACK,OAAO,CAAC;EACnD;EAEAC,+BAA+BA,CAC7B7C,MAAyC;IAEzC,MAAM8C,cAAc,GAClB9C,MAAM,CAAC+C,IAAI,KAAKtC,SAAS,GACrB,IAAI,CAAC,CAAArB,sBAAuB,CAAC4D,mBAAmB,EAAE,GAClD,CAAC,IAAI,CAAC,CAAA5D,sBAAuB,CAAC6C,UAAU,CAACjC,MAAM,CAAC+C,IAAI,CAAC,CAAC;IAE5D,OAAO;MACLE,MAAM,EAAE;QACNC,QAAQ,EAAEJ,cAAc,CAACK,GAAG,CAAEC,CAAC,IAC7BA,CAAC,CAACC,oBAAoB,CAACrD,MAAM,CAACsD,QAAQ,IAAIC,MAAM,CAACC,SAAS,CAAC;;KAGhE;EACH;EAEA,MAAMC,8BAA8BA,CAClCzD,MAAwC;IAExC,MAAM0D,gBAAgB,GAAG,IAAI,CAAC,CAAArE,aAAc,CAACO,aAAa,EAAE;IAC5D,IAAI+D,gBAAgB,GAAGlD,SAAS;IAChC,IAAIT,MAAM,CAAC2D,gBAAgB,KAAKlD,SAAS,EAAE;MACzCkD,gBAAgB,GAAG,IAAI,CAAC,CAAAvE,sBAAuB,CAAC6C,UAAU,CACxDjC,MAAM,CAAC2D,gBAAgB,CACxB;MACD,IAAI,CAACA,gBAAgB,CAACC,iBAAiB,EAAE,EAAE;QACzC,MAAM,IAAI9E,aAAA,CAAA+E,OAAO,CAACC,wBAAwB,CACxC,gDAAgD,CACjD;;;IAIL,MAAMb,MAAM,GAAG,MAAMS,gBAAgB,CAAClC,WAAW,CAAC,qBAAqB,EAAE;MACvEuC,GAAG,EAAE,aAAa;MAClBC,SAAS,EAAEhE,MAAM,CAACiE,IAAI,KAAK;KAC5B,CAAC;IAEF;IACA;IACA;IACA;IACA;IACA,MAAM7B,SAAS,GAAGa,MAAM,CAAClB,QAAQ;IACjC,MAAMW,OAAO,GAAG,IAAI,CAAC,CAAAtD,sBAAuB,CAAC6C,UAAU,CAACG,SAAS,CAAC;IAClE,MAAMM,OAAO,CAACwB,WAAW,EAAE;IAE3B,OAAO;MACLjB,MAAM,EAAEP,OAAO,CAACW,oBAAoB,CAAC,CAAC;KACvC;EACH;EAEAc,gCAAgCA,CAC9BnE,MAA0C;IAE1C,MAAM0C,OAAO,GAAG,IAAI,CAAC,CAAAtD,sBAAuB,CAAC6C,UAAU,CAACjC,MAAM,CAAC0C,OAAO,CAAC;IAEvE,OAAOA,OAAO,CAAC0B,QAAQ,CACrBpE,MAAM,CAAC+D,GAAG,EACV/D,MAAM,CAACqE,IAAI,KAAK5D,SAAS,GAAG,MAAM,GAAGT,MAAM,CAACqE,IAAI,CACjD;EACH;EAEA,MAAMC,yCAAyCA,CAC7CtE,MAAmD;IAEnD,MAAM0C,OAAO,GAAG,IAAI,CAAC,CAAAtD,sBAAuB,CAAC6C,UAAU,CAACjC,MAAM,CAAC0C,OAAO,CAAC;IACvE,OAAOA,OAAO,CAAC6B,iBAAiB,EAAE;EACpC;EAEA,MAAMC,6BAA6BA,CACjCxE,MAAuC;IAEvC,MAAM0C,OAAO,GAAG,IAAI,CAAC,CAAAtD,sBAAuB,CAAC6C,UAAU,CAACjC,MAAM,CAAC0C,OAAO,CAAC;IACvE,OAAOA,OAAO,CAAC+B,KAAK,CAACzE,MAAM,CAAC;EAC9B;EAEA,MAAM0E,+BAA+BA,CACnC1E,MAAyC;IAEzC,MAAMkD,QAAQ,GAA0B,EAAE;IAC1C,MAAMyB,OAAO,GAAoC,EAAE;IAEnD,IAAI3E,MAAM,CAAC0C,OAAO,EAAE;MAClB;MACA;MACAQ,QAAQ,CAAC0B,IAAI,CAAC,IAAI,CAAC,CAAAxF,sBAAuB,CAAC6C,UAAU,CAACjC,MAAM,CAAC0C,OAAO,CAAC,CAAC;KACvE,MAAM;MACL;MACA;MACAQ,QAAQ,CAAC0B,IAAI,CAAC,GAAG,IAAI,CAAC,CAAAxF,sBAAuB,CAACyF,cAAc,EAAE,CAAC;;IAGjEF,OAAO,CAACC,IAAI,CACV,IAAI,MAAME,OAAO,CAACC,GAAG,CACnB7B,QAAQ,CAACC,GAAG,CAAET,OAAO,IAAKA,OAAO,CAACsC,gBAAgB,CAAChF,MAAM,CAAC,CAAC,CAC5D,CAAC,CACH;IAED;IACA,OAAO2E,OAAO,CAAC,CAAC,CAAE;EACpB;EAEA;EACA,MAAMM,kCAAkCA,CACtCC,OAA6C;IAE7C,MAAM,IAAIpG,aAAA,CAAA+E,OAAO,CAACsB,qBAAqB,CAAC,kBAAkB,CAAC;IAE3D,OAAO,EAAE;EACX;EAEA,MAAMC,uBAAuBA,CAC3BpF,MAAiC;IAEjC,MAAMyC,KAAK,GAAG,MAAM,IAAI,CAAC,CAAAJ,QAAS,CAACrC,MAAM,CAACuC,MAAM,CAAC;IACjD,OAAOE,KAAK,CAAC4C,cAAc,CACzBrF,MAAM,CAACsF,UAAU,EACjBtF,MAAM,CAACuF,YAAY,EACnBvF,MAAM,CAACwF,eAAe,IAAI,MAAM,CACjC;EACH;EAEAC,wBAAwBA,CACtBzF,MAAkC;IAElC,IAAIA,MAAM,CAAC0C,OAAO,KAAKjC,SAAS,EAAE;MAChC;MACA,IAAI,CAAC,CAAArB,sBAAuB,CAAC6C,UAAU,CAACjC,MAAM,CAAC0C,OAAO,CAAC;;IAEzD,MAAMgD,MAAM,GAAG,IAAI,CAAC,CAAAlG,YAAa,CAC9BmG,UAAU,CAAC;MACVC,iBAAiB,EAAE5F,MAAM,CAAC0C,OAAO;MACjCuB,IAAI,EAAEjE,MAAM,CAACiE;KACd,CAAC,CACDd,GAAG,CAAEV,KAAY,IAAKA,KAAK,CAACoD,MAAM,EAAE,CAAC;IACxC,OAAO;MAAC5C,MAAM,EAAE;QAACyC;MAAM;IAAC,CAAC;EAC3B;EAEA,MAAMI,2BAA2BA,CAC/B9F,MAAqC;IAErC,MAAMyC,KAAK,GAAG,MAAM,IAAI,CAAC,CAAAJ,QAAS,CAACrC,MAAM,CAACuC,MAAM,CAAC;IACjD,OAAOE,KAAK,CAACsD,YAAY,CACvB/F,MAAM,CAACgG,mBAAmB,EAC1BhG,MAAM,CAACiG,IAAI,IAAI;MACbhC,IAAI,EAAE;KACP;IAAE;IACHjE,MAAM,CAACkG,SAAS,IAAI,EAAE;IAAE;IACxBlG,MAAM,CAACuF,YAAY,EACnBvF,MAAM,CAACwF,eAAe,IAAI,MAAM,CACjC;EACH;EAEA,MAAMW,qBAAqBA,CACzBnG,MAA+B;IAE/B,MAAMyC,KAAK,GAAG,MAAM,IAAI,CAAC,CAAAJ,QAAS,CAACrC,MAAM,CAACuC,MAAM,CAAC;IACjD,MAAMuC,OAAO,CAACC,GAAG,CAAC/E,MAAM,CAACoG,OAAO,CAACjD,GAAG,CAAC,MAAOkD,CAAC,IAAK5D,KAAK,CAAC6D,MAAM,CAACD,CAAC,CAAC,CAAC,CAAC;IACnE,OAAO;MAACpD,MAAM,EAAE;IAAE,CAAC;EACrB;EAEA,MAAMsD,6BAA6BA,CACjCC,aAA8C;IAE9C,MAAM9C,gBAAgB,GAAG,IAAI,CAAC,CAAArE,aAAc,CAACO,aAAa,EAAE;IAE5D,MAAM8C,OAAO,GAAG,IAAI,CAAC,CAAAtD,sBAAuB,CAAC6C,UAAU,CACrDuE,aAAa,CAAC9D,OAAO,CACtB;IACD,IAAI,CAACA,OAAO,CAACkB,iBAAiB,EAAE,EAAE;MAChC,MAAM,IAAI9E,aAAA,CAAA+E,OAAO,CAACC,wBAAwB,CACxC,gDAAgD,CACjD;;IAGH,MAAM2C,yBAAyB,GAAG,IAAI3B,OAAO,CAAQ4B,OAAO,IAAI;MAC9D,MAAMC,kBAAkB,GACtBC,WAAoD,IAClD;QACF,IAAIA,WAAW,CAAC7E,QAAQ,KAAKyE,aAAa,CAAC9D,OAAO,EAAE;UAClDgB,gBAAgB,CAACmD,GAAG,CAAC,2BAA2B,EAAEF,kBAAkB,CAAC;UACrED,OAAO,EAAE;;MAEb,CAAC;MACDhD,gBAAgB,CAAC3D,EAAE,CAAC,2BAA2B,EAAE4G,kBAAkB,CAAC;IACtE,CAAC,CAAC;IAEF,MAAMjD,gBAAgB,CAAClC,WAAW,CAAC,oBAAoB,EAAE;MACvDO,QAAQ,EAAEyE,aAAa,CAAC9D;KACzB,CAAC;IAEF;IACA;IACA;IACA,MAAM+D,yBAAyB;IAE/B,OAAO;MAACxD,MAAM,EAAE;IAAE,CAAC;EACrB;EAEA,CAAA1B,aAAcuF,CAACvE,MAAkC;IAC/C,IAAIA,MAAM,CAACR,QAAQ,KAAK,IAAI,CAAC,CAAAtC,YAAa,EAAE;MAC1C,OAAO,KAAK;;IAEd,OAAO,CAAC,MAAM,EAAE,QAAQ,CAAC,CAACsH,QAAQ,CAACxE,MAAM,CAAC0B,IAAI,CAAC;EACjD;EAEA,MAAM+C,uBAAuBA,CAAChH,MAA6B;IACzD,MAAMiH,MAAM,GAAGjH,MAAM,CAACkH,UAAU,GAC5B,IAAI,CAAC,CAAA7H,aAAc,CAACiC,YAAY,CAACtB,MAAM,CAACkH,UAAU,CAAC,GACnD,IAAI,CAAC,CAAA7H,aAAc,CAACO,aAAa,EAAE;IACvC,MAAMuH,oBAAoB,GAAG,MAAMF,MAAM,CAACzF,WAAW,CACnDxB,MAAM,CAACoH,SAAS,EAChBpH,MAAM,CAACqH,SAAS,CACjB;IACD,OAAO;MACLpE,MAAM,EAAEkE,oBAAoB;MAC5BD,UAAU,EAAElH,MAAM,CAACkH;KACpB;EACH;EAEAI,sBAAsBA,CAACtH,MAA4B;IACjD,MAAM0C,OAAO,GAAG1C,MAAM,CAAC0C,OAAO;IAC9B,MAAMvB,SAAS,GACb,IAAI,CAAC,CAAA/B,sBAAuB,CAAC6C,UAAU,CAACS,OAAO,CAAC,CAAC9B,SAAS,CAAC2G,YAAY;IACzE,IAAIpG,SAAS,KAAKV,SAAS,EAAE;MAC3B,OAAO;QAACwC,MAAM,EAAE;UAACiE,UAAU,EAAE;QAAI;MAAC,CAAC;;IAErC,OAAO;MAACjE,MAAM,EAAE;QAACiE,UAAU,EAAE/F;MAAS;IAAC,CAAC;EAC1C;;AAnZFqG,OAAA,CAAArI,wBAAA,GAAAA,wBAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}