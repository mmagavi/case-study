{"ast":null,"code":"var __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _PipeTransport_instances, _PipeTransport_pipeWrite, _PipeTransport_eventListeners, _PipeTransport_isClosed, _PipeTransport_pendingMessage, _PipeTransport_dispatch;\nimport { addEventListener, debugError, removeEventListeners } from '../common/util.js';\nimport { assert } from '../util/assert.js';\n/**\n * @internal\n */\nexport class PipeTransport {\n  constructor(pipeWrite, pipeRead) {\n    _PipeTransport_instances.add(this);\n    _PipeTransport_pipeWrite.set(this, void 0);\n    _PipeTransport_eventListeners.set(this, void 0);\n    _PipeTransport_isClosed.set(this, false);\n    _PipeTransport_pendingMessage.set(this, '');\n    __classPrivateFieldSet(this, _PipeTransport_pipeWrite, pipeWrite, \"f\");\n    __classPrivateFieldSet(this, _PipeTransport_eventListeners, [addEventListener(pipeRead, 'data', buffer => {\n      return __classPrivateFieldGet(this, _PipeTransport_instances, \"m\", _PipeTransport_dispatch).call(this, buffer);\n    }), addEventListener(pipeRead, 'close', () => {\n      if (this.onclose) {\n        this.onclose.call(null);\n      }\n    }), addEventListener(pipeRead, 'error', debugError), addEventListener(pipeWrite, 'error', debugError)], \"f\");\n  }\n  send(message) {\n    assert(!__classPrivateFieldGet(this, _PipeTransport_isClosed, \"f\"), '`PipeTransport` is closed.');\n    __classPrivateFieldGet(this, _PipeTransport_pipeWrite, \"f\").write(message);\n    __classPrivateFieldGet(this, _PipeTransport_pipeWrite, \"f\").write('\\0');\n  }\n  close() {\n    __classPrivateFieldSet(this, _PipeTransport_isClosed, true, \"f\");\n    removeEventListeners(__classPrivateFieldGet(this, _PipeTransport_eventListeners, \"f\"));\n  }\n}\n_PipeTransport_pipeWrite = new WeakMap(), _PipeTransport_eventListeners = new WeakMap(), _PipeTransport_isClosed = new WeakMap(), _PipeTransport_pendingMessage = new WeakMap(), _PipeTransport_instances = new WeakSet(), _PipeTransport_dispatch = function _PipeTransport_dispatch(buffer) {\n  assert(!__classPrivateFieldGet(this, _PipeTransport_isClosed, \"f\"), '`PipeTransport` is closed.');\n  let end = buffer.indexOf('\\0');\n  if (end === -1) {\n    __classPrivateFieldSet(this, _PipeTransport_pendingMessage, __classPrivateFieldGet(this, _PipeTransport_pendingMessage, \"f\") + buffer.toString(), \"f\");\n    return;\n  }\n  const message = __classPrivateFieldGet(this, _PipeTransport_pendingMessage, \"f\") + buffer.toString(undefined, 0, end);\n  if (this.onmessage) {\n    this.onmessage.call(null, message);\n  }\n  let start = end + 1;\n  end = buffer.indexOf('\\0', start);\n  while (end !== -1) {\n    if (this.onmessage) {\n      this.onmessage.call(null, buffer.toString(undefined, start, end));\n    }\n    start = end + 1;\n    end = buffer.indexOf('\\0', start);\n  }\n  __classPrivateFieldSet(this, _PipeTransport_pendingMessage, buffer.toString(undefined, start), \"f\");\n};","map":{"version":3,"names":["addEventListener","debugError","removeEventListeners","assert","PipeTransport","constructor","pipeWrite","pipeRead","_PipeTransport_pipeWrite","set","_PipeTransport_eventListeners","_PipeTransport_isClosed","_PipeTransport_pendingMessage","__classPrivateFieldSet","buffer","__classPrivateFieldGet","_PipeTransport_instances","_PipeTransport_dispatch","call","onclose","send","message","write","close","end","indexOf","toString","undefined","onmessage","start"],"sources":["../../../../src/node/PipeTransport.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}