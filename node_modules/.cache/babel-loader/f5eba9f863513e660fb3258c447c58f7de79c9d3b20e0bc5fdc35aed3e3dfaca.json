{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2019 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar _IsolatedWorld_instances, _IsolatedWorld_frame, _IsolatedWorld_document, _IsolatedWorld_context, _IsolatedWorld_detached, _IsolatedWorld_contextBindings, _IsolatedWorld_bindings, _IsolatedWorld_taskManager, _IsolatedWorld_client_get, _IsolatedWorld_frameManager_get, _IsolatedWorld_timeoutSettings_get, _IsolatedWorld_mutex, _IsolatedWorld_onBindingCalled, _Mutex_locked, _Mutex_acquirers;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.IsolatedWorld = void 0;\nconst assert_js_1 = require(\"../util/assert.js\");\nconst DeferredPromise_js_1 = require(\"../util/DeferredPromise.js\");\nconst IsolatedWorlds_js_1 = require(\"./IsolatedWorlds.js\");\nconst LifecycleWatcher_js_1 = require(\"./LifecycleWatcher.js\");\nconst util_js_1 = require(\"./util.js\");\nconst WaitTask_js_1 = require(\"./WaitTask.js\");\n/**\n * @internal\n */\nclass IsolatedWorld {\n  get taskManager() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\");\n  }\n  get _bindings() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_bindings, \"f\");\n  }\n  constructor(frame) {\n    _IsolatedWorld_instances.add(this);\n    _IsolatedWorld_frame.set(this, void 0);\n    _IsolatedWorld_document.set(this, void 0);\n    _IsolatedWorld_context.set(this, (0, DeferredPromise_js_1.createDeferredPromise)());\n    _IsolatedWorld_detached.set(this, false);\n    // Set of bindings that have been registered in the current context.\n    _IsolatedWorld_contextBindings.set(this, new Set());\n    // Contains mapping from functions that should be bound to Puppeteer functions.\n    _IsolatedWorld_bindings.set(this, new Map());\n    _IsolatedWorld_taskManager.set(this, new WaitTask_js_1.TaskManager());\n    // If multiple waitFor are set up asynchronously, we need to wait for the\n    // first one to set up the binding in the page before running the others.\n    _IsolatedWorld_mutex.set(this, new Mutex());\n    _IsolatedWorld_onBindingCalled.set(this, async event => {\n      let payload;\n      try {\n        payload = JSON.parse(event.payload);\n      } catch {\n        // The binding was either called by something in the page or it was\n        // called before our wrapper was initialized.\n        return;\n      }\n      const {\n        type,\n        name,\n        seq,\n        args,\n        isTrivial\n      } = payload;\n      if (type !== 'internal') {\n        return;\n      }\n      if (!__classPrivateFieldGet(this, _IsolatedWorld_contextBindings, \"f\").has(name)) {\n        return;\n      }\n      const context = await __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\");\n      if (event.executionContextId !== context._contextId) {\n        return;\n      }\n      const binding = this._bindings.get(name);\n      await (binding === null || binding === void 0 ? void 0 : binding.run(context, seq, args, isTrivial));\n    });\n    // Keep own reference to client because it might differ from the FrameManager's\n    // client for OOP iframes.\n    __classPrivateFieldSet(this, _IsolatedWorld_frame, frame, \"f\");\n    __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).on('Runtime.bindingCalled', __classPrivateFieldGet(this, _IsolatedWorld_onBindingCalled, \"f\"));\n  }\n  frame() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\");\n  }\n  clearContext() {\n    __classPrivateFieldSet(this, _IsolatedWorld_document, undefined, \"f\");\n    __classPrivateFieldSet(this, _IsolatedWorld_context, (0, DeferredPromise_js_1.createDeferredPromise)(), \"f\");\n  }\n  setContext(context) {\n    __classPrivateFieldGet(this, _IsolatedWorld_contextBindings, \"f\").clear();\n    __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\").resolve(context);\n    __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\").rerunAll();\n  }\n  hasContext() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\").resolved();\n  }\n  _detach() {\n    __classPrivateFieldSet(this, _IsolatedWorld_detached, true, \"f\");\n    __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).off('Runtime.bindingCalled', __classPrivateFieldGet(this, _IsolatedWorld_onBindingCalled, \"f\"));\n    __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\").terminateAll(new Error('waitForFunction failed: frame got detached.'));\n  }\n  executionContext() {\n    if (__classPrivateFieldGet(this, _IsolatedWorld_detached, \"f\")) {\n      throw new Error(`Execution context is not available in detached frame \"${__classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\").url()}\" (are you trying to evaluate?)`);\n    }\n    if (__classPrivateFieldGet(this, _IsolatedWorld_context, \"f\") === null) {\n      throw new Error(`Execution content promise is missing`);\n    }\n    return __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\");\n  }\n  async evaluateHandle(pageFunction, ...args) {\n    const context = await this.executionContext();\n    return context.evaluateHandle(pageFunction, ...args);\n  }\n  async evaluate(pageFunction, ...args) {\n    const context = await this.executionContext();\n    return context.evaluate(pageFunction, ...args);\n  }\n  async $(selector) {\n    const document = await this.document();\n    return document.$(selector);\n  }\n  async $$(selector) {\n    const document = await this.document();\n    return document.$$(selector);\n  }\n  async document() {\n    if (__classPrivateFieldGet(this, _IsolatedWorld_document, \"f\")) {\n      return __classPrivateFieldGet(this, _IsolatedWorld_document, \"f\");\n    }\n    const context = await this.executionContext();\n    __classPrivateFieldSet(this, _IsolatedWorld_document, await context.evaluateHandle(() => {\n      return document;\n    }), \"f\");\n    return __classPrivateFieldGet(this, _IsolatedWorld_document, \"f\");\n  }\n  async $x(expression) {\n    const document = await this.document();\n    return document.$x(expression);\n  }\n  async $eval(selector, pageFunction, ...args) {\n    const document = await this.document();\n    return document.$eval(selector, pageFunction, ...args);\n  }\n  async $$eval(selector, pageFunction, ...args) {\n    const document = await this.document();\n    return document.$$eval(selector, pageFunction, ...args);\n  }\n  async content() {\n    return await this.evaluate(() => {\n      let retVal = '';\n      if (document.doctype) {\n        retVal = new XMLSerializer().serializeToString(document.doctype);\n      }\n      if (document.documentElement) {\n        retVal += document.documentElement.outerHTML;\n      }\n      return retVal;\n    });\n  }\n  async setContent(html, options = {}) {\n    const {\n      waitUntil = ['load'],\n      timeout = __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_timeoutSettings_get).navigationTimeout()\n    } = options;\n    await (0, util_js_1.setPageContent)(this, html);\n    const watcher = new LifecycleWatcher_js_1.LifecycleWatcher(__classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_frameManager_get), __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\"), waitUntil, timeout);\n    const error = await Promise.race([watcher.timeoutOrTerminationPromise(), watcher.lifecyclePromise()]);\n    watcher.dispose();\n    if (error) {\n      throw error;\n    }\n  }\n  async click(selector, options = {}) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, `No element found for selector: ${selector}`);\n    await handle.click(options);\n    await handle.dispose();\n  }\n  async focus(selector) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, `No element found for selector: ${selector}`);\n    await handle.focus();\n    await handle.dispose();\n  }\n  async hover(selector) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, `No element found for selector: ${selector}`);\n    await handle.hover();\n    await handle.dispose();\n  }\n  async select(selector, ...values) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, `No element found for selector: ${selector}`);\n    const result = await handle.select(...values);\n    await handle.dispose();\n    return result;\n  }\n  async tap(selector) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, `No element found for selector: ${selector}`);\n    await handle.tap();\n    await handle.dispose();\n  }\n  async type(selector, text, options) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, `No element found for selector: ${selector}`);\n    await handle.type(text, options);\n    await handle.dispose();\n  }\n  async _addBindingToContext(context, name) {\n    if (__classPrivateFieldGet(this, _IsolatedWorld_contextBindings, \"f\").has(name)) {\n      return;\n    }\n    await __classPrivateFieldGet(this, _IsolatedWorld_mutex, \"f\").acquire();\n    try {\n      await context._client.send('Runtime.addBinding', {\n        name,\n        executionContextName: context._contextName\n      });\n      await context.evaluate(util_js_1.addPageBinding, 'internal', name);\n      __classPrivateFieldGet(this, _IsolatedWorld_contextBindings, \"f\").add(name);\n    } catch (error) {\n      // We could have tried to evaluate in a context which was already\n      // destroyed. This happens, for example, if the page is navigated while\n      // we are trying to add the binding\n      if (error instanceof Error) {\n        // Destroyed context.\n        if (error.message.includes('Execution context was destroyed')) {\n          return;\n        }\n        // Missing context.\n        if (error.message.includes('Cannot find context with specified id')) {\n          return;\n        }\n      }\n      (0, util_js_1.debugError)(error);\n    } finally {\n      __classPrivateFieldGet(this, _IsolatedWorld_mutex, \"f\").release();\n    }\n  }\n  waitForFunction(pageFunction, options = {}, ...args) {\n    const {\n      polling = 'raf',\n      timeout = __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_timeoutSettings_get).timeout(),\n      root,\n      signal\n    } = options;\n    if (typeof polling === 'number' && polling < 0) {\n      throw new Error('Cannot poll with non-positive interval');\n    }\n    const waitTask = new WaitTask_js_1.WaitTask(this, {\n      polling,\n      root,\n      timeout,\n      signal\n    }, pageFunction, ...args);\n    return waitTask.result;\n  }\n  async title() {\n    return this.evaluate(() => {\n      return document.title;\n    });\n  }\n  async adoptBackendNode(backendNodeId) {\n    const executionContext = await this.executionContext();\n    const {\n      object\n    } = await __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).send('DOM.resolveNode', {\n      backendNodeId: backendNodeId,\n      executionContextId: executionContext._contextId\n    });\n    return (0, util_js_1.createJSHandle)(executionContext, object);\n  }\n  async adoptHandle(handle) {\n    const context = await this.executionContext();\n    (0, assert_js_1.assert)(handle.executionContext() !== context, 'Cannot adopt handle that already belongs to this execution context');\n    const nodeInfo = await __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).send('DOM.describeNode', {\n      objectId: handle.id\n    });\n    return await this.adoptBackendNode(nodeInfo.node.backendNodeId);\n  }\n  async transferHandle(handle) {\n    const context = await this.executionContext();\n    if (handle.executionContext() === context) {\n      return handle;\n    }\n    const info = await __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).send('DOM.describeNode', {\n      objectId: handle.remoteObject().objectId\n    });\n    const newHandle = await this.adoptBackendNode(info.node.backendNodeId);\n    await handle.dispose();\n    return newHandle;\n  }\n}\nexports.IsolatedWorld = IsolatedWorld;\n_IsolatedWorld_frame = new WeakMap(), _IsolatedWorld_document = new WeakMap(), _IsolatedWorld_context = new WeakMap(), _IsolatedWorld_detached = new WeakMap(), _IsolatedWorld_contextBindings = new WeakMap(), _IsolatedWorld_bindings = new WeakMap(), _IsolatedWorld_taskManager = new WeakMap(), _IsolatedWorld_mutex = new WeakMap(), _IsolatedWorld_onBindingCalled = new WeakMap(), _IsolatedWorld_instances = new WeakSet(), _IsolatedWorld_client_get = function _IsolatedWorld_client_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\")._client();\n}, _IsolatedWorld_frameManager_get = function _IsolatedWorld_frameManager_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\")._frameManager;\n}, _IsolatedWorld_timeoutSettings_get = function _IsolatedWorld_timeoutSettings_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_frameManager_get).timeoutSettings;\n};\nclass Mutex {\n  constructor() {\n    _Mutex_locked.set(this, false);\n    _Mutex_acquirers.set(this, []);\n  }\n  // This is FIFO.\n  acquire() {\n    if (!__classPrivateFieldGet(this, _Mutex_locked, \"f\")) {\n      __classPrivateFieldSet(this, _Mutex_locked, true, \"f\");\n      return Promise.resolve();\n    }\n    let resolve;\n    const promise = new Promise(res => {\n      resolve = res;\n    });\n    __classPrivateFieldGet(this, _Mutex_acquirers, \"f\").push(resolve);\n    return promise;\n  }\n  release() {\n    const resolve = __classPrivateFieldGet(this, _Mutex_acquirers, \"f\").shift();\n    if (!resolve) {\n      __classPrivateFieldSet(this, _Mutex_locked, false, \"f\");\n      return;\n    }\n    resolve();\n  }\n}\n_Mutex_locked = new WeakMap(), _Mutex_acquirers = new WeakMap();","map":{"version":3,"names":["assert_js_1","require","DeferredPromise_js_1","IsolatedWorlds_js_1","LifecycleWatcher_js_1","util_js_1","WaitTask_js_1","IsolatedWorld","taskManager","__classPrivateFieldGet","_IsolatedWorld_taskManager","_bindings","_IsolatedWorld_bindings","constructor","frame","_IsolatedWorld_frame","set","_IsolatedWorld_document","_IsolatedWorld_context","createDeferredPromise","_IsolatedWorld_detached","_IsolatedWorld_contextBindings","Set","Map","TaskManager","_IsolatedWorld_mutex","Mutex","_IsolatedWorld_onBindingCalled","event","payload","JSON","parse","type","name","seq","args","isTrivial","has","context","executionContextId","_contextId","binding","get","run","__classPrivateFieldSet","_IsolatedWorld_instances","_IsolatedWorld_client_get","on","clearContext","undefined","setContext","clear","resolve","rerunAll","hasContext","resolved","_detach","off","terminateAll","Error","executionContext","url","evaluateHandle","pageFunction","evaluate","$","selector","document","$$","$x","expression","$eval","$$eval","content","retVal","doctype","XMLSerializer","serializeToString","documentElement","outerHTML","setContent","html","options","waitUntil","timeout","_IsolatedWorld_timeoutSettings_get","navigationTimeout","setPageContent","watcher","LifecycleWatcher","_IsolatedWorld_frameManager_get","error","Promise","race","timeoutOrTerminationPromise","lifecyclePromise","dispose","click","handle","assert","focus","hover","select","values","result","tap","text","_addBindingToContext","acquire","_client","send","executionContextName","_contextName","addPageBinding","add","message","includes","debugError","release","waitForFunction","polling","root","signal","waitTask","WaitTask","title","adoptBackendNode","backendNodeId","object","createJSHandle","adoptHandle","nodeInfo","objectId","id","node","transferHandle","info","remoteObject","newHandle","exports","_frameManager","timeoutSettings","_Mutex_locked","_Mutex_acquirers","promise","res","push","shift"],"sources":["../../../../src/common/IsolatedWorld.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}