{"ast":null,"code":"/**\n * Copyright 2023 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _Cache_rootDir;\nimport fs from 'fs';\nimport path from 'path';\nimport { Browser } from './browser-data/browser-data.js';\n/**\n * The cache used by Puppeteer relies on the following structure:\n *\n * - rootDir\n *   -- <browser1> | browserRoot(browser1)\n *   ---- <platform>-<buildId> | installationDir()\n *   ------ the browser-platform-buildId\n *   ------ specific structure.\n *   -- <browser2> | browserRoot(browser2)\n *   ---- <platform>-<buildId> | installationDir()\n *   ------ the browser-platform-buildId\n *   ------ specific structure.\n *   @internal\n */\nexport class Cache {\n  constructor(rootDir) {\n    _Cache_rootDir.set(this, void 0);\n    __classPrivateFieldSet(this, _Cache_rootDir, rootDir, \"f\");\n  }\n  browserRoot(browser) {\n    // Chromium is a special case for backward compatibility: we install it in\n    // the Chrome folder so that Puppeteer can find it.\n    return path.join(__classPrivateFieldGet(this, _Cache_rootDir, \"f\"), browser === Browser.CHROMIUM ? Browser.CHROME : browser);\n  }\n  installationDir(browser, platform, buildId) {\n    return path.join(this.browserRoot(browser), `${platform}-${buildId}`);\n  }\n  clear() {\n    fs.rmSync(__classPrivateFieldGet(this, _Cache_rootDir, \"f\"), {\n      force: true,\n      recursive: true,\n      maxRetries: 10,\n      retryDelay: 500\n    });\n  }\n  getInstalledBrowsers() {\n    if (!fs.existsSync(__classPrivateFieldGet(this, _Cache_rootDir, \"f\"))) {\n      return [];\n    }\n    const types = fs.readdirSync(__classPrivateFieldGet(this, _Cache_rootDir, \"f\"));\n    const browsers = types.filter(t => {\n      return Object.values(Browser).includes(t);\n    });\n    return browsers.flatMap(browser => {\n      const files = fs.readdirSync(this.browserRoot(browser));\n      return files.map(file => {\n        const result = parseFolderPath(path.join(this.browserRoot(browser), file));\n        if (!result) {\n          return null;\n        }\n        return {\n          path: path.join(this.browserRoot(browser), file),\n          browser,\n          platform: result.platform,\n          buildId: result.buildId\n        };\n      }).filter(item => {\n        return item !== null;\n      });\n    });\n  }\n}\n_Cache_rootDir = new WeakMap();\nfunction parseFolderPath(folderPath) {\n  const name = path.basename(folderPath);\n  const splits = name.split('-');\n  if (splits.length !== 2) {\n    return;\n  }\n  const [platform, buildId] = splits;\n  if (!buildId || !platform) {\n    return;\n  }\n  return {\n    platform,\n    buildId\n  };\n}","map":{"version":3,"names":["fs","path","Browser","Cache","constructor","rootDir","_Cache_rootDir","set","__classPrivateFieldSet","browserRoot","browser","join","__classPrivateFieldGet","CHROMIUM","CHROME","installationDir","platform","buildId","clear","rmSync","force","recursive","maxRetries","retryDelay","getInstalledBrowsers","existsSync","types","readdirSync","browsers","filter","t","Object","values","includes","flatMap","files","map","file","result","parseFolderPath","item","folderPath","name","basename","splits","split","length"],"sources":["../../src/Cache.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}